INFO     2022-03-19 19:14:50.457 request id: app - uvicorn.server:serve - Started server process [74492]
INFO     2022-03-19 19:14:50.458 request id: app - uvicorn.server:serve - Started server process [74492]
INFO     2022-03-19 19:14:50.458 request id: app - uvicorn.server:serve - Started server process [74492]
INFO     2022-03-19 19:14:50.458 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:14:50.458 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:14:50.458 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:14:50.470 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x105297010>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:14:50.470 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:14:50.471 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:14:50.471 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:14:50.471 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:15:40.509 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:15:40.509 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:15:40.509 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:15:40.611 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:15:40.611 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:15:40.611 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:15:40.612 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:15:40.612 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:15:40.612 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:15:40.613 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:15:40.613 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:15:40.613 request id: app - uvicorn.server:serve - Finished server process [74492]
INFO     2022-03-19 19:15:40.613 request id: app - uvicorn.server:serve - Finished server process [74492]
INFO     2022-03-19 19:15:40.613 request id: app - uvicorn.server:serve - Finished server process [74492]
INFO     2022-03-19 19:15:40.995 request id: app - uvicorn.server:serve - Started server process [74715]
INFO     2022-03-19 19:15:40.995 request id: app - uvicorn.server:serve - Started server process [74715]
INFO     2022-03-19 19:15:40.995 request id: app - uvicorn.server:serve - Started server process [74715]
INFO     2022-03-19 19:15:40.995 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:15:40.995 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:15:40.995 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:15:41.001 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103559ab0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:15:41.001 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:15:41.002 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:15:41.002 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:15:41.002 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:17:13.398 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:17:13.398 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:17:13.398 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:17:13.499 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:17:13.500 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:17:13.500 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:17:13.501 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:17:13.501 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:17:13.501 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:17:13.501 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:17:13.502 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:17:13.502 request id: app - uvicorn.server:serve - Finished server process [74715]
INFO     2022-03-19 19:17:13.502 request id: app - uvicorn.server:serve - Finished server process [74715]
INFO     2022-03-19 19:17:13.502 request id: app - uvicorn.server:serve - Finished server process [74715]
INFO     2022-03-19 19:19:11.308 request id: app - uvicorn.server:serve - Started server process [75451]
INFO     2022-03-19 19:19:11.308 request id: app - uvicorn.server:serve - Started server process [75451]
INFO     2022-03-19 19:19:11.308 request id: app - uvicorn.server:serve - Started server process [75451]
INFO     2022-03-19 19:19:11.309 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:19:11.309 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:19:11.309 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:19:11.318 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103e11ab0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:19:11.319 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:19:11.319 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:19:11.319 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:19:11.320 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:19:23.048 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:19:23.048 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:19:23.048 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:19:23.150 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:19:23.150 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:19:23.150 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:19:23.152 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:19:23.152 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:19:23.152 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:19:23.152 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:19:23.152 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:19:23.152 request id: app - uvicorn.server:serve - Finished server process [75451]
INFO     2022-03-19 19:19:23.153 request id: app - uvicorn.server:serve - Finished server process [75451]
INFO     2022-03-19 19:19:23.153 request id: app - uvicorn.server:serve - Finished server process [75451]
INFO     2022-03-19 19:19:23.537 request id: app - uvicorn.server:serve - Started server process [75496]
INFO     2022-03-19 19:19:23.537 request id: app - uvicorn.server:serve - Started server process [75496]
INFO     2022-03-19 19:19:23.538 request id: app - uvicorn.server:serve - Started server process [75496]
INFO     2022-03-19 19:19:23.538 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:19:23.538 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:19:23.538 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:19:23.543 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10795a5f0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:19:23.543 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:19:23.543 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:19:23.544 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:19:23.544 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:20:49.071 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:20:49.071 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:20:49.071 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:20:49.172 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:20:49.173 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:20:49.173 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:20:49.174 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:20:49.174 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:20:49.174 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:20:49.174 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:20:49.175 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:20:49.175 request id: app - uvicorn.server:serve - Finished server process [75496]
INFO     2022-03-19 19:20:49.175 request id: app - uvicorn.server:serve - Finished server process [75496]
INFO     2022-03-19 19:20:49.175 request id: app - uvicorn.server:serve - Finished server process [75496]
INFO     2022-03-19 19:20:49.555 request id: app - uvicorn.server:serve - Started server process [75775]
INFO     2022-03-19 19:20:49.555 request id: app - uvicorn.server:serve - Started server process [75775]
INFO     2022-03-19 19:20:49.555 request id: app - uvicorn.server:serve - Started server process [75775]
INFO     2022-03-19 19:20:49.555 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:20:49.556 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:20:49.556 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:20:49.561 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x106a67580>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:20:49.562 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:20:49.562 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:20:49.562 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:20:49.563 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:21:51.431 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:21:51.431 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:21:51.431 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:21:51.533 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:21:51.533 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:21:51.533 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:21:51.534 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:21:51.534 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:21:51.534 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:21:51.535 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:21:51.535 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:21:51.535 request id: app - uvicorn.server:serve - Finished server process [75775]
INFO     2022-03-19 19:21:51.535 request id: app - uvicorn.server:serve - Finished server process [75775]
INFO     2022-03-19 19:21:51.535 request id: app - uvicorn.server:serve - Finished server process [75775]
INFO     2022-03-19 19:34:48.947 request id: app - uvicorn.server:serve - Started server process [76658]
INFO     2022-03-19 19:34:48.947 request id: app - uvicorn.server:serve - Started server process [76658]
INFO     2022-03-19 19:34:48.947 request id: app - uvicorn.server:serve - Started server process [76658]
INFO     2022-03-19 19:34:48.947 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:34:48.948 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:34:48.948 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:34:48.957 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x106e7f010>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:34:48.958 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:34:48.958 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:34:48.958 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:34:48.958 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:35:22.335 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:35:22.336 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:35:22.336 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:35:22.437 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:35:22.437 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:35:22.437 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:35:22.438 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:35:22.438 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:35:22.439 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:35:22.439 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:35:22.439 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:35:22.439 request id: app - uvicorn.server:serve - Finished server process [76658]
INFO     2022-03-19 19:35:22.439 request id: app - uvicorn.server:serve - Finished server process [76658]
INFO     2022-03-19 19:35:22.440 request id: app - uvicorn.server:serve - Finished server process [76658]
INFO     2022-03-19 19:35:22.869 request id: app - uvicorn.server:serve - Started server process [76676]
INFO     2022-03-19 19:35:22.870 request id: app - uvicorn.server:serve - Started server process [76676]
INFO     2022-03-19 19:35:22.870 request id: app - uvicorn.server:serve - Started server process [76676]
INFO     2022-03-19 19:35:22.870 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:35:22.870 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:35:22.870 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:35:22.876 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104e9f9a0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:35:22.876 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:35:22.877 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:35:22.877 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:35:22.877 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:35:53.931 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:35:53.931 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:35:53.931 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:35:54.032 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:35:54.032 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:35:54.032 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:35:54.034 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:35:54.034 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:35:54.034 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:35:54.034 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:35:54.034 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:35:54.035 request id: app - uvicorn.server:serve - Finished server process [76676]
INFO     2022-03-19 19:35:54.035 request id: app - uvicorn.server:serve - Finished server process [76676]
INFO     2022-03-19 19:35:54.035 request id: app - uvicorn.server:serve - Finished server process [76676]
INFO     2022-03-19 19:35:54.446 request id: app - uvicorn.server:serve - Started server process [76712]
INFO     2022-03-19 19:35:54.446 request id: app - uvicorn.server:serve - Started server process [76712]
INFO     2022-03-19 19:35:54.446 request id: app - uvicorn.server:serve - Started server process [76712]
INFO     2022-03-19 19:35:54.447 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:35:54.447 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:35:54.447 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:35:54.452 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x106861a50>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:35:54.452 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:35:54.452 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:35:54.453 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:35:54.453 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:36:41.277 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:36:41.277 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:36:41.277 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:36:41.378 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:36:41.379 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:36:41.379 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:36:41.380 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:36:41.380 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:36:41.381 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:36:41.381 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:36:41.381 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:36:41.381 request id: app - uvicorn.server:serve - Finished server process [76712]
INFO     2022-03-19 19:36:41.381 request id: app - uvicorn.server:serve - Finished server process [76712]
INFO     2022-03-19 19:36:41.381 request id: app - uvicorn.server:serve - Finished server process [76712]
INFO     2022-03-19 19:36:45.141 request id: app - uvicorn.server:serve - Started server process [76792]
INFO     2022-03-19 19:36:45.142 request id: app - uvicorn.server:serve - Started server process [76792]
INFO     2022-03-19 19:36:45.142 request id: app - uvicorn.server:serve - Started server process [76792]
INFO     2022-03-19 19:36:45.142 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:36:45.142 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:36:45.142 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:36:45.148 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10379f700>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:36:45.148 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:36:45.149 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:36:45.149 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:36:45.150 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:36:49.293 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:36:49.293 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:36:49.294 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:36:49.395 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:36:49.395 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:36:49.395 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:36:49.396 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:36:49.396 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:36:49.396 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:36:49.397 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:36:49.397 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:36:49.397 request id: app - uvicorn.server:serve - Finished server process [76792]
INFO     2022-03-19 19:36:49.397 request id: app - uvicorn.server:serve - Finished server process [76792]
INFO     2022-03-19 19:36:49.397 request id: app - uvicorn.server:serve - Finished server process [76792]
INFO     2022-03-19 19:36:49.786 request id: app - uvicorn.server:serve - Started server process [76807]
INFO     2022-03-19 19:36:49.786 request id: app - uvicorn.server:serve - Started server process [76807]
INFO     2022-03-19 19:36:49.786 request id: app - uvicorn.server:serve - Started server process [76807]
INFO     2022-03-19 19:36:49.786 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:36:49.786 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:36:49.786 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:36:49.791 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10509f7f0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:36:49.791 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:36:49.792 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:36:49.792 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:36:49.792 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:37:57.764 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:37:57.764 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:37:57.764 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:37:57.865 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:37:57.865 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:37:57.865 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:37:57.867 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:37:57.867 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:37:57.867 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:37:57.867 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:37:57.867 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:37:57.868 request id: app - uvicorn.server:serve - Finished server process [76807]
INFO     2022-03-19 19:37:57.868 request id: app - uvicorn.server:serve - Finished server process [76807]
INFO     2022-03-19 19:37:57.868 request id: app - uvicorn.server:serve - Finished server process [76807]
INFO     2022-03-19 19:37:58.345 request id: app - uvicorn.server:serve - Started server process [77322]
INFO     2022-03-19 19:37:58.345 request id: app - uvicorn.server:serve - Started server process [77322]
INFO     2022-03-19 19:37:58.345 request id: app - uvicorn.server:serve - Started server process [77322]
INFO     2022-03-19 19:37:58.346 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:37:58.346 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:37:58.346 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:37:58.353 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10349f490>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:37:58.353 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:37:58.354 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:37:58.354 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:37:58.354 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:39:59.069 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:39:59.070 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:39:59.070 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:39:59.171 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:39:59.171 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:39:59.172 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:39:59.173 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:39:59.173 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:39:59.173 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:39:59.173 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:39:59.173 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:39:59.174 request id: app - uvicorn.server:serve - Finished server process [77322]
INFO     2022-03-19 19:39:59.174 request id: app - uvicorn.server:serve - Finished server process [77322]
INFO     2022-03-19 19:39:59.174 request id: app - uvicorn.server:serve - Finished server process [77322]
INFO     2022-03-19 19:39:59.600 request id: app - uvicorn.server:serve - Started server process [77464]
INFO     2022-03-19 19:39:59.600 request id: app - uvicorn.server:serve - Started server process [77464]
INFO     2022-03-19 19:39:59.600 request id: app - uvicorn.server:serve - Started server process [77464]
INFO     2022-03-19 19:39:59.601 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:39:59.601 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:39:59.601 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:39:59.607 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103f9f820>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:39:59.607 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:39:59.608 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:39:59.608 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:39:59.608 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:47:52.159 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:47:52.159 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:47:52.159 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:47:52.261 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:47:52.261 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:47:52.261 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:47:52.262 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:47:52.263 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:47:52.263 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:47:52.263 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:47:52.263 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:47:52.264 request id: app - uvicorn.server:serve - Finished server process [77464]
INFO     2022-03-19 19:47:52.264 request id: app - uvicorn.server:serve - Finished server process [77464]
INFO     2022-03-19 19:47:52.264 request id: app - uvicorn.server:serve - Finished server process [77464]
INFO     2022-03-19 19:47:52.700 request id: app - uvicorn.server:serve - Started server process [78015]
INFO     2022-03-19 19:47:52.700 request id: app - uvicorn.server:serve - Started server process [78015]
INFO     2022-03-19 19:47:52.700 request id: app - uvicorn.server:serve - Started server process [78015]
INFO     2022-03-19 19:47:52.700 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:47:52.701 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:47:52.701 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:47:52.707 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1057832b0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:47:52.707 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:47:52.707 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:47:52.708 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:47:52.708 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:49:49.101 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:49:49.101 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:49:49.101 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:49:49.202 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:49:49.202 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:49:49.202 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:49:49.203 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:49:49.204 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:49:49.204 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:49:49.204 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:49:49.204 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:49:49.204 request id: app - uvicorn.server:serve - Finished server process [78015]
INFO     2022-03-19 19:49:49.204 request id: app - uvicorn.server:serve - Finished server process [78015]
INFO     2022-03-19 19:49:49.204 request id: app - uvicorn.server:serve - Finished server process [78015]
INFO     2022-03-19 19:49:49.586 request id: app - uvicorn.server:serve - Started server process [78080]
INFO     2022-03-19 19:49:49.586 request id: app - uvicorn.server:serve - Started server process [78080]
INFO     2022-03-19 19:49:49.586 request id: app - uvicorn.server:serve - Started server process [78080]
INFO     2022-03-19 19:49:49.586 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:49:49.586 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:49:49.586 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:49:49.592 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1055833a0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:49:49.592 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:49:49.593 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:49:49.593 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:49:49.593 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:53:49.605 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:53:49.605 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:53:49.605 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:53:49.706 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:53:49.707 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:53:49.707 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:53:49.708 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:53:49.708 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:53:49.708 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:53:49.708 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:53:49.708 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:53:49.708 request id: app - uvicorn.server:serve - Finished server process [78080]
INFO     2022-03-19 19:53:49.708 request id: app - uvicorn.server:serve - Finished server process [78080]
INFO     2022-03-19 19:53:49.708 request id: app - uvicorn.server:serve - Finished server process [78080]
INFO     2022-03-19 19:53:50.096 request id: app - uvicorn.server:serve - Started server process [78163]
INFO     2022-03-19 19:53:50.096 request id: app - uvicorn.server:serve - Started server process [78163]
INFO     2022-03-19 19:53:50.096 request id: app - uvicorn.server:serve - Started server process [78163]
INFO     2022-03-19 19:53:50.096 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:53:50.096 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:53:50.097 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:53:50.101 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104a9f700>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:53:50.101 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:53:50.102 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:53:50.102 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:53:50.102 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:54:05.447 request id: None - main:errors_handling - Here Is Your Info Log
INFO     2022-03-19 19:54:05.453 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59804 - "GET /docs HTTP/1.1" 200
INFO     2022-03-19 19:54:05.559 request id: None - main:errors_handling - Here Is Your Info Log
INFO     2022-03-19 19:54:05.572 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59804 - "GET /openapi.json HTTP/1.1" 200
INFO     2022-03-19 19:54:10.145 request id: None - main:errors_handling - Here Is Your Info Log
INFO     2022-03-19 19:54:10.157 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59804 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 19:56:30.443 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:56:30.443 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:56:30.444 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:56:30.545 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:56:30.545 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:56:30.545 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:56:30.547 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:56:30.547 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:56:30.548 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:56:30.548 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:56:30.548 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:56:30.548 request id: app - uvicorn.server:serve - Finished server process [78163]
INFO     2022-03-19 19:56:30.548 request id: app - uvicorn.server:serve - Finished server process [78163]
INFO     2022-03-19 19:56:30.549 request id: app - uvicorn.server:serve - Finished server process [78163]
INFO     2022-03-19 19:56:30.955 request id: app - uvicorn.server:serve - Started server process [78213]
INFO     2022-03-19 19:56:30.955 request id: app - uvicorn.server:serve - Started server process [78213]
INFO     2022-03-19 19:56:30.955 request id: app - uvicorn.server:serve - Started server process [78213]
INFO     2022-03-19 19:56:30.955 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:56:30.956 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:56:30.956 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:56:30.961 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x106d4abc0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:56:30.961 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:56:30.961 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:56:30.961 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:56:30.962 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:57:07.868 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:57:07.868 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:57:07.868 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:57:07.969 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:57:07.969 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:57:07.969 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:57:07.970 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:57:07.970 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:57:07.970 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:57:07.971 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:57:07.971 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:57:07.971 request id: app - uvicorn.server:serve - Finished server process [78213]
INFO     2022-03-19 19:57:07.971 request id: app - uvicorn.server:serve - Finished server process [78213]
INFO     2022-03-19 19:57:07.971 request id: app - uvicorn.server:serve - Finished server process [78213]
INFO     2022-03-19 19:57:08.344 request id: app - uvicorn.server:serve - Started server process [78237]
INFO     2022-03-19 19:57:08.344 request id: app - uvicorn.server:serve - Started server process [78237]
INFO     2022-03-19 19:57:08.344 request id: app - uvicorn.server:serve - Started server process [78237]
INFO     2022-03-19 19:57:08.344 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:57:08.344 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:57:08.344 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:57:08.350 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x105727190>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:57:08.351 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:57:08.351 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:57:08.351 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:57:08.351 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:01.025 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:58:01.025 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:58:01.025 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:58:01.126 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:58:01.127 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:58:01.127 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:58:01.128 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:58:01.128 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:58:01.129 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:58:01.129 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:58:01.129 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:58:01.129 request id: app - uvicorn.server:serve - Finished server process [78237]
INFO     2022-03-19 19:58:01.129 request id: app - uvicorn.server:serve - Finished server process [78237]
INFO     2022-03-19 19:58:01.129 request id: app - uvicorn.server:serve - Finished server process [78237]
INFO     2022-03-19 19:58:01.508 request id: app - uvicorn.server:serve - Started server process [78257]
INFO     2022-03-19 19:58:01.508 request id: app - uvicorn.server:serve - Started server process [78257]
INFO     2022-03-19 19:58:01.508 request id: app - uvicorn.server:serve - Started server process [78257]
INFO     2022-03-19 19:58:01.508 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:58:01.508 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:58:01.508 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:58:01.513 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1033bf700>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:58:01.513 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:58:01.514 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:01.514 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:01.514 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:15.596 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59853 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 19:58:15.597 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x100ef9900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x100e4bd00>
           └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e4b370>
    └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x100eef4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
    │    └ <function subprocess_started at 0x101b6ee60>
    └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x100eef520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x101b6e200>
           │       │   └ <uvicorn.server.Server object at 0x100eef520>
           │       └ <function run at 0x1012a9240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x101b16c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1012a7520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012a7490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012a9000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101253d90>
    └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x101c2d5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x101c2d630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101bcda80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x101c29180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101bcda80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1033bf910>
          └ <fastapi.applications.FastAPI object at 0x101c29180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1033afeb0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1033bf880>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1033bf910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1034111b0>
                     │    │             └ <starlette.requests.Request object at 0x103430550>
                     │    └ <function exception_handling at 0x1033af880>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1033bf880>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 18, in exception_handling
    request.app.logger.info(request.user)
    │       │               │       └ <property object at 0x1029d4cc0>
    │       │               └ <starlette.requests.Request object at 0x103430550>
    │       └ <property object at 0x1029c6610>
    └ <starlette.requests.Request object at 0x103430550>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/requests.py", line 153, in user
    assert (

AssertionError: AuthenticationMiddleware must be installed to access request.user
ERROR    2022-03-19 19:58:15.611 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x100ef9900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x100e4bd00>
           └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e4b370>
    └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x100eef4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
    │    └ <function subprocess_started at 0x101b6ee60>
    └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x100eef520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x101b6e200>
           │       │   └ <uvicorn.server.Server object at 0x100eef520>
           │       └ <function run at 0x1012a9240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x101b16c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1012a7520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012a7490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012a9000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101253d90>
    └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x101c2d5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x101c2d630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101bcda80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x101c29180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101bcda80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1033bf910>
          └ <fastapi.applications.FastAPI object at 0x101c29180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1033afeb0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1033bf880>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1033bf910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1034111b0>
                     │    │             └ <starlette.requests.Request object at 0x103430550>
                     │    └ <function exception_handling at 0x1033af880>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1033bf880>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 18, in exception_handling
    request.app.logger.info(request.user)
    │       │               │       └ <property object at 0x1029d4cc0>
    │       │               └ <starlette.requests.Request object at 0x103430550>
    │       └ <property object at 0x1029c6610>
    └ <starlette.requests.Request object at 0x103430550>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/requests.py", line 153, in user
    assert (

AssertionError: AuthenticationMiddleware must be installed to access request.user
ERROR    2022-03-19 19:58:15.615 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x100ef9900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x100e4bd00>
           └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x100e4b370>
    └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x100eef4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
    │    └ <function subprocess_started at 0x101b6ee60>
    └ <SpawnProcess name='SpawnProcess-17' parent=76574 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x100eef520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x101b6e200>
           │       │   └ <uvicorn.server.Server object at 0x100eef520>
           │       └ <function run at 0x1012a9240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x101b16c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1012a7520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1012a7490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1012a9000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101253d90>
    └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x103430520>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x101c2d5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x101c2d630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101bcda80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x101c29180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101bcda80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1033bf910>
          └ <fastapi.applications.FastAPI object at 0x101c29180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1033afeb0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1034304f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1033bf880>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1033bf910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1034111b0>
                     │    │             └ <starlette.requests.Request object at 0x103430550>
                     │    └ <function exception_handling at 0x1033af880>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1033bf880>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 18, in exception_handling
    request.app.logger.info(request.user)
    │       │               │       └ <property object at 0x1029d4cc0>
    │       │               └ <starlette.requests.Request object at 0x103430550>
    │       └ <property object at 0x1029c6610>
    └ <starlette.requests.Request object at 0x103430550>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/requests.py", line 153, in user
    assert (

AssertionError: AuthenticationMiddleware must be installed to access request.user
INFO     2022-03-19 19:58:47.327 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:58:47.328 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:58:47.328 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:58:47.429 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:58:47.430 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:58:47.430 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:58:47.431 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:58:47.431 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:58:47.431 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:58:47.431 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:58:47.431 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:58:47.431 request id: app - uvicorn.server:serve - Finished server process [78257]
INFO     2022-03-19 19:58:47.432 request id: app - uvicorn.server:serve - Finished server process [78257]
INFO     2022-03-19 19:58:47.432 request id: app - uvicorn.server:serve - Finished server process [78257]
INFO     2022-03-19 19:58:47.863 request id: app - uvicorn.server:serve - Started server process [78286]
INFO     2022-03-19 19:58:47.864 request id: app - uvicorn.server:serve - Started server process [78286]
INFO     2022-03-19 19:58:47.864 request id: app - uvicorn.server:serve - Started server process [78286]
INFO     2022-03-19 19:58:47.864 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:58:47.864 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:58:47.865 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:58:47.871 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x102c9f280>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:58:47.871 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:58:47.872 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:47.872 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:47.873 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:58:49.630 request id: None - main:exception_handling - <coroutine object Request.json at 0x102cc1a10>
INFO     2022-03-19 19:58:49.641 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59865 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 19:59:29.142 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:59:29.143 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:59:29.143 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 19:59:29.244 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:59:29.244 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:59:29.245 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 19:59:29.261 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 19:59:29.262 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 19:59:29.262 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:59:29.262 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:59:29.262 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 19:59:29.262 request id: app - uvicorn.server:serve - Finished server process [78286]
INFO     2022-03-19 19:59:29.262 request id: app - uvicorn.server:serve - Finished server process [78286]
INFO     2022-03-19 19:59:29.263 request id: app - uvicorn.server:serve - Finished server process [78286]
INFO     2022-03-19 19:59:29.639 request id: app - uvicorn.server:serve - Started server process [78313]
INFO     2022-03-19 19:59:29.640 request id: app - uvicorn.server:serve - Started server process [78313]
INFO     2022-03-19 19:59:29.640 request id: app - uvicorn.server:serve - Started server process [78313]
INFO     2022-03-19 19:59:29.640 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:59:29.640 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:59:29.640 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 19:59:29.646 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x101a71a50>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 19:59:29.646 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 19:59:29.647 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:59:29.647 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:59:29.647 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 19:59:31.455 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 19:59:31.464 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59872 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:02:04.180 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:02:04.180 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:02:04.180 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:02:04.281 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:02:04.282 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:02:04.282 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:02:04.283 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:02:04.284 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:02:04.284 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:02:04.284 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:02:04.284 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:02:04.284 request id: app - uvicorn.server:serve - Finished server process [78313]
INFO     2022-03-19 20:02:04.284 request id: app - uvicorn.server:serve - Finished server process [78313]
INFO     2022-03-19 20:02:04.284 request id: app - uvicorn.server:serve - Finished server process [78313]
INFO     2022-03-19 20:04:24.680 request id: app - uvicorn.server:serve - Started server process [78441]
INFO     2022-03-19 20:04:24.680 request id: app - uvicorn.server:serve - Started server process [78441]
INFO     2022-03-19 20:04:24.680 request id: app - uvicorn.server:serve - Started server process [78441]
INFO     2022-03-19 20:04:24.680 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:04:24.680 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:04:24.680 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:04:24.697 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x107a7ada0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:04:24.698 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:04:24.699 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:04:24.699 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:04:24.699 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:04:56.230 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:04:56.238 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59940 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:05:35.056 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:05:35.056 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:05:35.056 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:05:35.157 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:05:35.158 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:05:35.158 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:05:35.159 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:05:35.160 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:05:35.160 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:05:35.160 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:05:35.160 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:05:35.160 request id: app - uvicorn.server:serve - Finished server process [78441]
INFO     2022-03-19 20:05:35.161 request id: app - uvicorn.server:serve - Finished server process [78441]
INFO     2022-03-19 20:05:35.161 request id: app - uvicorn.server:serve - Finished server process [78441]
INFO     2022-03-19 20:05:35.586 request id: app - uvicorn.server:serve - Started server process [78471]
INFO     2022-03-19 20:05:35.586 request id: app - uvicorn.server:serve - Started server process [78471]
INFO     2022-03-19 20:05:35.587 request id: app - uvicorn.server:serve - Started server process [78471]
INFO     2022-03-19 20:05:35.587 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:05:35.587 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:05:35.587 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:05:35.593 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10735f3a0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:05:35.594 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:05:35.594 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:05:35.595 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:05:35.595 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:05:49.109 request id: None - main:exception_handling - new GET request
INFO     2022-03-19 20:05:49.115 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59947 - "GET /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:06:29.787 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:06:29.787 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:06:29.787 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:06:29.889 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:06:29.889 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:06:29.889 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:06:29.890 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:06:29.890 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:06:29.890 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:06:29.890 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:06:29.891 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:06:29.891 request id: app - uvicorn.server:serve - Finished server process [78471]
INFO     2022-03-19 20:06:29.891 request id: app - uvicorn.server:serve - Finished server process [78471]
INFO     2022-03-19 20:06:29.891 request id: app - uvicorn.server:serve - Finished server process [78471]
INFO     2022-03-19 20:06:30.321 request id: app - uvicorn.server:serve - Started server process [78496]
INFO     2022-03-19 20:06:30.321 request id: app - uvicorn.server:serve - Started server process [78496]
INFO     2022-03-19 20:06:30.321 request id: app - uvicorn.server:serve - Started server process [78496]
INFO     2022-03-19 20:06:30.321 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:06:30.321 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:06:30.321 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:06:30.327 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10889f280>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:06:30.328 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:06:30.328 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:06:30.328 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:06:30.328 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:06:44.492 request id: None - main:exception_handling - new DELETE request
INFO     2022-03-19 20:06:44.499 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59953 - "DELETE /api/messages/4 HTTP/1.1" 204
INFO     2022-03-19 20:07:13.832 request id: None - main:exception_handling - new GET request
INFO     2022-03-19 20:07:13.839 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59967 - "GET /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:08:59.859 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:08:59.859 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:08:59.859 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:08:59.960 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:08:59.961 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:08:59.961 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:08:59.963 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:08:59.964 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:08:59.964 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:08:59.964 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:08:59.964 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:08:59.964 request id: app - uvicorn.server:serve - Finished server process [78496]
INFO     2022-03-19 20:08:59.964 request id: app - uvicorn.server:serve - Finished server process [78496]
INFO     2022-03-19 20:08:59.964 request id: app - uvicorn.server:serve - Finished server process [78496]
INFO     2022-03-19 20:09:00.398 request id: app - uvicorn.server:serve - Started server process [78553]
INFO     2022-03-19 20:09:00.398 request id: app - uvicorn.server:serve - Started server process [78553]
INFO     2022-03-19 20:09:00.398 request id: app - uvicorn.server:serve - Started server process [78553]
INFO     2022-03-19 20:09:00.398 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:00.398 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:00.398 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:00.405 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103f9f370>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:09:00.405 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:09:00.406 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:00.406 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:00.406 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:11.232 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:09:11.242 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59985 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:09:25.703 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:25.704 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:25.704 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:25.807 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:25.807 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:25.808 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:25.812 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:09:25.812 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:09:25.813 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:25.813 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:25.813 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:25.814 request id: app - uvicorn.server:serve - Finished server process [78553]
INFO     2022-03-19 20:09:25.814 request id: app - uvicorn.server:serve - Finished server process [78553]
INFO     2022-03-19 20:09:25.814 request id: app - uvicorn.server:serve - Finished server process [78553]
INFO     2022-03-19 20:09:28.603 request id: app - uvicorn.server:serve - Started server process [78584]
INFO     2022-03-19 20:09:28.603 request id: app - uvicorn.server:serve - Started server process [78584]
INFO     2022-03-19 20:09:28.603 request id: app - uvicorn.server:serve - Started server process [78584]
INFO     2022-03-19 20:09:28.604 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:28.604 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:28.604 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:28.610 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x107737490>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:09:28.610 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:09:28.611 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:28.611 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:28.611 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:32.699 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:09:32.706 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59991 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:09:43.079 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:43.080 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:43.080 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:43.181 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:43.182 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:43.182 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:43.183 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:09:43.183 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:09:43.184 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:43.184 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:43.184 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:43.184 request id: app - uvicorn.server:serve - Finished server process [78584]
INFO     2022-03-19 20:09:43.184 request id: app - uvicorn.server:serve - Finished server process [78584]
INFO     2022-03-19 20:09:43.184 request id: app - uvicorn.server:serve - Finished server process [78584]
INFO     2022-03-19 20:09:43.591 request id: app - uvicorn.server:serve - Started server process [78612]
INFO     2022-03-19 20:09:43.591 request id: app - uvicorn.server:serve - Started server process [78612]
INFO     2022-03-19 20:09:43.591 request id: app - uvicorn.server:serve - Started server process [78612]
INFO     2022-03-19 20:09:43.592 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:43.592 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:43.592 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:43.598 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10459f490>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:09:43.598 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:09:43.599 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:43.599 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:43.599 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:54.015 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:54.016 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:54.016 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:09:54.117 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:54.117 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:54.118 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:09:54.119 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:09:54.119 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:09:54.119 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:54.119 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:54.120 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:09:54.120 request id: app - uvicorn.server:serve - Finished server process [78612]
INFO     2022-03-19 20:09:54.120 request id: app - uvicorn.server:serve - Finished server process [78612]
INFO     2022-03-19 20:09:54.120 request id: app - uvicorn.server:serve - Finished server process [78612]
INFO     2022-03-19 20:09:54.492 request id: app - uvicorn.server:serve - Started server process [78635]
INFO     2022-03-19 20:09:54.492 request id: app - uvicorn.server:serve - Started server process [78635]
INFO     2022-03-19 20:09:54.492 request id: app - uvicorn.server:serve - Started server process [78635]
INFO     2022-03-19 20:09:54.492 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:54.492 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:54.492 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:09:54.499 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:09:54.499 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:09:54.500 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:54.500 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:54.500 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:09:59.220 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:09:59.224 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:59999 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:09:59.225 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x102b3da20>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x102b3dab0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1014e5900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1013e3d00>
           └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1013e3370>
    └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1014db4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
    │    └ <function subprocess_started at 0x102106e60>
    └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1014db520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x102106200>
           │       │   └ <uvicorn.server.Server object at 0x1014db520>
           │       └ <function run at 0x101895240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x1020aec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x101893520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101893490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101895000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10183fd90>
    └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1021c55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1021c5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102165a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1021c1180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102165a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1039cf760>
          └ <fastapi.applications.FastAPI object at 0x1021c1180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1039f43a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1039cf760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x103a29630>
                     │    │             └ <starlette.requests.Request object at 0x103a44790>
                     │    └ <function exception_handling at 0x1039bb9a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 20, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x103a44790>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x103a29630>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'Message' object has no attribute 'title'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x102b3e200>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x102fe8e00>
          │    │   │      └ <starlette.requests.Request object at 0x103a44790>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1039cf6a0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039cf610>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1039cf6a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1021c1240>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039cf610>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1030485e0>
          └ <fastapi.routing.APIRoute object at 0x103997760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10397fa30>
          └ <fastapi.routing.APIRoute object at 0x103997760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x103a74370>
                     └ <function get_request_handler.<locals>.app at 0x10397fbe0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x103049240>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x103a746a0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10397ecb0>
                 └ <fastapi.dependencies.models.Dependant object at 0x103997850>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x10330c310>
                 └ <repositories.message.MessageRepository object at 0x103a746a0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x102ae0790>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x103227400>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
          │        └ <function Model.save at 0x103226f80>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
          │    └ <function Model._pre_save at 0x103226e60>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1039f3d10>]
          │       └ <function gather at 0x101877880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 12, in signal_pre_save
    print('message_pre_save: ', sender, instance, using_db, update_fields)
                                │       │         │         └ None
                                │       │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
                                │       └ <Message>
                                └ <class 'models.message.Message'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 10, in __str__
    return self.title
           └ <Message>

AttributeError: 'Message' object has no attribute 'title'
ERROR    2022-03-19 20:09:59.240 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x102b3da20>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x102b3dab0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1014e5900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1013e3d00>
           └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1013e3370>
    └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1014db4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
    │    └ <function subprocess_started at 0x102106e60>
    └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1014db520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x102106200>
           │       │   └ <uvicorn.server.Server object at 0x1014db520>
           │       └ <function run at 0x101895240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x1020aec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x101893520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101893490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101895000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10183fd90>
    └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1021c55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1021c5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102165a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1021c1180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102165a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1039cf760>
          └ <fastapi.applications.FastAPI object at 0x1021c1180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1039f43a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1039cf760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x103a29630>
                     │    │             └ <starlette.requests.Request object at 0x103a44790>
                     │    └ <function exception_handling at 0x1039bb9a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 20, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x103a44790>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x103a29630>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'Message' object has no attribute 'title'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x102b3e200>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x102fe8e00>
          │    │   │      └ <starlette.requests.Request object at 0x103a44790>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1039cf6a0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039cf610>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1039cf6a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1021c1240>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039cf610>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1030485e0>
          └ <fastapi.routing.APIRoute object at 0x103997760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10397fa30>
          └ <fastapi.routing.APIRoute object at 0x103997760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x103a74370>
                     └ <function get_request_handler.<locals>.app at 0x10397fbe0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x103049240>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x103a746a0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10397ecb0>
                 └ <fastapi.dependencies.models.Dependant object at 0x103997850>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x10330c310>
                 └ <repositories.message.MessageRepository object at 0x103a746a0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x102ae0790>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x103227400>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
          │        └ <function Model.save at 0x103226f80>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
          │    └ <function Model._pre_save at 0x103226e60>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1039f3d10>]
          │       └ <function gather at 0x101877880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 12, in signal_pre_save
    print('message_pre_save: ', sender, instance, using_db, update_fields)
                                │       │         │         └ None
                                │       │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
                                │       └ <Message>
                                └ <class 'models.message.Message'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 10, in __str__
    return self.title
           └ <Message>

AttributeError: 'Message' object has no attribute 'title'
ERROR    2022-03-19 20:09:59.247 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x102b3da20>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x102b3dab0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1014e5900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1013e3d00>
           └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1013e3370>
    └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1014db4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
    │    └ <function subprocess_started at 0x102106e60>
    └ <SpawnProcess name='SpawnProcess-3' parent=78582 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1014db520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x102106200>
           │       │   └ <uvicorn.server.Server object at 0x1014db520>
           │       └ <function run at 0x101895240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x1020aec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x101893520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x101893490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x101895000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10183fd90>
    └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x103a74be0>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1021c55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1021c5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102165a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1021c1180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x102165a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1039cf760>
          └ <fastapi.applications.FastAPI object at 0x1021c1180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1039f43a0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1039cf760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x103a29630>
                     │    │             └ <starlette.requests.Request object at 0x103a44790>
                     │    └ <function exception_handling at 0x1039bb9a0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 20, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x103a44790>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x103a29630>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'Message' object has no attribute 'title'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x102b3e200>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x102fe8e00>
          │    │   │      └ <starlette.requests.Request object at 0x103a44790>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1039cf6a0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1039cf6d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039cf610>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1039cf6a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1021c1240>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1039cf610>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1030485e0>
          └ <fastapi.routing.APIRoute object at 0x103997760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x103a2a5f0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x103a44730>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10397fa30>
          └ <fastapi.routing.APIRoute object at 0x103997760>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x103a74370>
                     └ <function get_request_handler.<locals>.app at 0x10397fbe0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x103049240>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x103a746a0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10397ecb0>
                 └ <fastapi.dependencies.models.Dependant object at 0x103997850>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x10330c310>
                 └ <repositories.message.MessageRepository object at 0x103a746a0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x102ae0790>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x103227400>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
          │        └ <function Model.save at 0x103226f80>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
          │    └ <function Model._pre_save at 0x103226e60>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1039f3d10>]
          │       └ <function gather at 0x101877880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 12, in signal_pre_save
    print('message_pre_save: ', sender, instance, using_db, update_fields)
                                │       │         │         └ None
                                │       │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1039cf550>
                                │       └ <Message>
                                └ <class 'models.message.Message'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 10, in __str__
    return self.title
           └ <Message>

AttributeError: 'Message' object has no attribute 'title'
INFO     2022-03-19 20:12:22.274 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:12:22.274 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:12:22.274 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:12:22.376 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:12:22.376 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:12:22.376 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:12:22.382 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:12:22.382 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:12:22.382 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:12:22.382 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:12:22.383 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:12:22.383 request id: app - uvicorn.server:serve - Finished server process [78635]
INFO     2022-03-19 20:12:22.383 request id: app - uvicorn.server:serve - Finished server process [78635]
INFO     2022-03-19 20:12:22.383 request id: app - uvicorn.server:serve - Finished server process [78635]
INFO     2022-03-19 20:12:22.761 request id: app - uvicorn.server:serve - Started server process [78695]
INFO     2022-03-19 20:12:22.761 request id: app - uvicorn.server:serve - Started server process [78695]
INFO     2022-03-19 20:12:22.761 request id: app - uvicorn.server:serve - Started server process [78695]
INFO     2022-03-19 20:12:22.762 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:12:22.762 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:12:22.762 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:12:22.767 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1037874f0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:12:22.767 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:12:22.768 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:12:22.768 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:12:22.768 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:12:36.722 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:12:36.722 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:12:36.722 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:12:36.823 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:12:36.824 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:12:36.824 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:12:36.825 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:12:36.825 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:12:36.825 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:12:36.826 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:12:36.826 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:12:36.826 request id: app - uvicorn.server:serve - Finished server process [78695]
INFO     2022-03-19 20:12:36.826 request id: app - uvicorn.server:serve - Finished server process [78695]
INFO     2022-03-19 20:12:36.826 request id: app - uvicorn.server:serve - Finished server process [78695]
INFO     2022-03-19 20:12:37.203 request id: app - uvicorn.server:serve - Started server process [78713]
INFO     2022-03-19 20:12:37.203 request id: app - uvicorn.server:serve - Started server process [78713]
INFO     2022-03-19 20:12:37.203 request id: app - uvicorn.server:serve - Started server process [78713]
INFO     2022-03-19 20:12:37.203 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:12:37.203 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:12:37.204 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:12:37.209 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x107833340>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:12:37.209 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:12:37.210 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:12:37.210 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:12:37.210 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:14:04.796 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:14:04.796 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:14:04.796 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:14:04.898 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:14:04.898 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:14:04.898 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:14:04.900 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:14:04.900 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:14:04.900 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:14:04.900 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:14:04.901 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:14:04.901 request id: app - uvicorn.server:serve - Finished server process [78713]
INFO     2022-03-19 20:14:04.901 request id: app - uvicorn.server:serve - Finished server process [78713]
INFO     2022-03-19 20:14:04.901 request id: app - uvicorn.server:serve - Finished server process [78713]
INFO     2022-03-19 20:14:05.298 request id: app - uvicorn.server:serve - Started server process [78738]
INFO     2022-03-19 20:14:05.298 request id: app - uvicorn.server:serve - Started server process [78738]
INFO     2022-03-19 20:14:05.298 request id: app - uvicorn.server:serve - Started server process [78738]
INFO     2022-03-19 20:14:05.298 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:14:05.298 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:14:05.298 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:14:05.304 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10369f550>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:14:05.304 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:14:05.305 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:14:05.305 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:14:05.305 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:16:56.641 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:16:56.641 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:16:56.641 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:16:56.743 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:16:56.743 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:16:56.743 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:16:56.744 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:16:56.745 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:16:56.745 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:16:56.745 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:16:56.745 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:16:56.746 request id: app - uvicorn.server:serve - Finished server process [78738]
INFO     2022-03-19 20:16:56.746 request id: app - uvicorn.server:serve - Finished server process [78738]
INFO     2022-03-19 20:16:56.746 request id: app - uvicorn.server:serve - Finished server process [78738]
INFO     2022-03-19 20:16:57.200 request id: app - uvicorn.server:serve - Started server process [78769]
INFO     2022-03-19 20:16:57.200 request id: app - uvicorn.server:serve - Started server process [78769]
INFO     2022-03-19 20:16:57.200 request id: app - uvicorn.server:serve - Started server process [78769]
INFO     2022-03-19 20:16:57.200 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:16:57.200 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:16:57.201 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:16:57.208 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10741b880>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:16:57.208 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:16:57.209 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:16:57.209 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:16:57.209 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:17:04.285 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:17:04.286 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:17:04.286 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:17:04.387 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:17:04.387 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:17:04.387 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:17:04.389 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:17:04.389 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:17:04.389 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:17:04.389 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:17:04.390 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:17:04.390 request id: app - uvicorn.server:serve - Finished server process [78769]
INFO     2022-03-19 20:17:04.390 request id: app - uvicorn.server:serve - Finished server process [78769]
INFO     2022-03-19 20:17:04.390 request id: app - uvicorn.server:serve - Finished server process [78769]
INFO     2022-03-19 20:17:04.777 request id: app - uvicorn.server:serve - Started server process [78787]
INFO     2022-03-19 20:17:04.777 request id: app - uvicorn.server:serve - Started server process [78787]
INFO     2022-03-19 20:17:04.778 request id: app - uvicorn.server:serve - Started server process [78787]
INFO     2022-03-19 20:17:04.778 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:17:04.778 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:17:04.778 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:17:04.783 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10429f400>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:17:04.783 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:17:04.784 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:17:04.784 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:17:04.784 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:18:48.843 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:18:48.844 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:18:48.844 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:18:48.946 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:18:48.946 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:18:48.946 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:18:48.950 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:18:48.950 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:18:48.950 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:18:48.950 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:18:48.950 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:18:48.951 request id: app - uvicorn.server:serve - Finished server process [78787]
INFO     2022-03-19 20:18:48.951 request id: app - uvicorn.server:serve - Finished server process [78787]
INFO     2022-03-19 20:18:48.951 request id: app - uvicorn.server:serve - Finished server process [78787]
INFO     2022-03-19 20:18:49.391 request id: app - uvicorn.server:serve - Started server process [78817]
INFO     2022-03-19 20:18:49.391 request id: app - uvicorn.server:serve - Started server process [78817]
INFO     2022-03-19 20:18:49.391 request id: app - uvicorn.server:serve - Started server process [78817]
INFO     2022-03-19 20:18:49.391 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:18:49.391 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:18:49.391 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:18:49.398 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10579f580>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:18:49.399 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:18:49.399 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:18:49.399 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:18:49.400 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:18:57.292 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:18:57.292 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:18:57.292 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:18:57.394 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:18:57.394 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:18:57.395 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:18:57.396 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:18:57.396 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:18:57.396 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:18:57.396 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:18:57.396 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:18:57.397 request id: app - uvicorn.server:serve - Finished server process [78817]
INFO     2022-03-19 20:18:57.397 request id: app - uvicorn.server:serve - Finished server process [78817]
INFO     2022-03-19 20:18:57.397 request id: app - uvicorn.server:serve - Finished server process [78817]
INFO     2022-03-19 20:18:57.786 request id: app - uvicorn.server:serve - Started server process [78833]
INFO     2022-03-19 20:18:57.786 request id: app - uvicorn.server:serve - Started server process [78833]
INFO     2022-03-19 20:18:57.787 request id: app - uvicorn.server:serve - Started server process [78833]
INFO     2022-03-19 20:18:57.787 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:18:57.787 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:18:57.787 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:18:57.792 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104eb7880>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:18:57.793 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:18:57.793 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:18:57.793 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:18:57.793 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:19:24.894 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:19:24.894 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:19:24.894 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:19:24.996 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:19:24.996 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:19:24.996 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:19:24.998 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:19:24.998 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:19:24.998 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:19:24.999 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:19:24.999 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:19:24.999 request id: app - uvicorn.server:serve - Finished server process [78833]
INFO     2022-03-19 20:19:24.999 request id: app - uvicorn.server:serve - Finished server process [78833]
INFO     2022-03-19 20:19:24.999 request id: app - uvicorn.server:serve - Finished server process [78833]
INFO     2022-03-19 20:19:25.385 request id: app - uvicorn.server:serve - Started server process [78848]
INFO     2022-03-19 20:19:25.385 request id: app - uvicorn.server:serve - Started server process [78848]
INFO     2022-03-19 20:19:25.385 request id: app - uvicorn.server:serve - Started server process [78848]
INFO     2022-03-19 20:19:25.385 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:19:25.386 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:19:25.386 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:19:25.390 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1078135b0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:19:25.391 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:19:25.391 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:19:25.391 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:19:25.391 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:21:37.958 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:21:37.958 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:21:37.958 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:21:38.060 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:21:38.060 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:21:38.060 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:21:38.061 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:21:38.062 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:21:38.062 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:21:38.062 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:21:38.062 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:21:38.062 request id: app - uvicorn.server:serve - Finished server process [78848]
INFO     2022-03-19 20:21:38.062 request id: app - uvicorn.server:serve - Finished server process [78848]
INFO     2022-03-19 20:21:38.063 request id: app - uvicorn.server:serve - Finished server process [78848]
INFO     2022-03-19 20:23:43.959 request id: app - uvicorn.server:serve - Started server process [79098]
INFO     2022-03-19 20:23:43.959 request id: app - uvicorn.server:serve - Started server process [79098]
INFO     2022-03-19 20:23:43.959 request id: app - uvicorn.server:serve - Started server process [79098]
INFO     2022-03-19 20:23:43.960 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:23:43.960 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:23:43.960 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:23:43.973 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104edb730>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:23:43.974 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:23:43.974 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:23:43.974 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:23:43.975 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:00.359 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:24:00.359 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:24:00.359 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:24:00.461 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:24:00.461 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:24:00.461 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:24:00.462 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:24:00.462 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:24:00.463 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:24:00.463 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:24:00.463 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:24:00.463 request id: app - uvicorn.server:serve - Finished server process [79098]
INFO     2022-03-19 20:24:00.463 request id: app - uvicorn.server:serve - Finished server process [79098]
INFO     2022-03-19 20:24:00.463 request id: app - uvicorn.server:serve - Finished server process [79098]
INFO     2022-03-19 20:24:00.910 request id: app - uvicorn.server:serve - Started server process [79126]
INFO     2022-03-19 20:24:00.910 request id: app - uvicorn.server:serve - Started server process [79126]
INFO     2022-03-19 20:24:00.910 request id: app - uvicorn.server:serve - Started server process [79126]
INFO     2022-03-19 20:24:00.910 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:24:00.910 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:24:00.910 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:24:00.917 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:24:00.917 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:24:00.918 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:00.918 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:00.918 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:23.420 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:24:23.426 request id: app - models.message:signal_post_save - new message 9 - string
INFO     2022-03-19 20:24:23.427 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60152 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:24:23.428 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x107b09a20>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x107b09ab0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104f19900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104e17d00>
           └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104e17370>
    └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104f0f4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
    │    └ <function subprocess_started at 0x105d26e60>
    └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104f0f520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105d26200>
           │       │   └ <uvicorn.server.Server object at 0x104f0f520>
           │       └ <function run at 0x1059c5240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105c7ec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1059c3520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1059c3490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1059c5000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10596fd90>
    └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105de55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105de5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d85a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105de1180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d85a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10909f8e0>
          └ <fastapi.applications.FastAPI object at 0x105de1180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1090c8160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10909f8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1090f53f0>
                     │    │             └ <starlette.requests.Request object at 0x109110550>
                     │    └ <function exception_handling at 0x10908bac0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 20, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x109110550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1090f53f0>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'Message' object has no attribute 'title'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x107b0a200>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x107be8c20>
          │    │   │      └ <starlette.requests.Request object at 0x109110550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10909f820>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10909f790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10909f820>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105de1240>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10909f790>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x107d585e0>
          └ <fastapi.routing.APIRoute object at 0x1090677c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10904fb50>
          └ <fastapi.routing.APIRoute object at 0x1090677c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x109148130>
                     └ <function get_request_handler.<locals>.app at 0x10904fd00>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107d59240>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x109148460>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10904edd0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1090678b0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x1080b03a0>
                 └ <repositories.message.MessageRepository object at 0x109148460>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1076e0790>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x107f37400>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
          │        └ <function Model.save at 0x107f36f80>
          └ <Message: 9>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
          │    └ <function Model._post_save at 0x107f36ef0>
          └ <Message: 9>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x1090c3c30>]
          │       └ <function gather at 0x1059a7880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 33, in signal_post_save
    print('message_post_save: ', sender, instance, using_db, update_fields)
                                 │       │         │         └ None
                                 │       │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
                                 │       └ <Message: 9>
                                 └ <class 'models.message.Message'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 12, in __str__
    return self.title
           └ <Message: 9>

AttributeError: 'Message' object has no attribute 'title'
ERROR    2022-03-19 20:24:23.444 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x107b09a20>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x107b09ab0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104f19900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104e17d00>
           └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104e17370>
    └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104f0f4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
    │    └ <function subprocess_started at 0x105d26e60>
    └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104f0f520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105d26200>
           │       │   └ <uvicorn.server.Server object at 0x104f0f520>
           │       └ <function run at 0x1059c5240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105c7ec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1059c3520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1059c3490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1059c5000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10596fd90>
    └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105de55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105de5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d85a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105de1180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d85a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10909f8e0>
          └ <fastapi.applications.FastAPI object at 0x105de1180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1090c8160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10909f8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1090f53f0>
                     │    │             └ <starlette.requests.Request object at 0x109110550>
                     │    └ <function exception_handling at 0x10908bac0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 20, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x109110550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1090f53f0>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'Message' object has no attribute 'title'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x107b0a200>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x107be8c20>
          │    │   │      └ <starlette.requests.Request object at 0x109110550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10909f820>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10909f790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10909f820>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105de1240>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10909f790>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x107d585e0>
          └ <fastapi.routing.APIRoute object at 0x1090677c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10904fb50>
          └ <fastapi.routing.APIRoute object at 0x1090677c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x109148130>
                     └ <function get_request_handler.<locals>.app at 0x10904fd00>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107d59240>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x109148460>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10904edd0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1090678b0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x1080b03a0>
                 └ <repositories.message.MessageRepository object at 0x109148460>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1076e0790>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x107f37400>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
          │        └ <function Model.save at 0x107f36f80>
          └ <Message: 9>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
          │    └ <function Model._post_save at 0x107f36ef0>
          └ <Message: 9>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x1090c3c30>]
          │       └ <function gather at 0x1059a7880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 33, in signal_post_save
    print('message_post_save: ', sender, instance, using_db, update_fields)
                                 │       │         │         └ None
                                 │       │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
                                 │       └ <Message: 9>
                                 └ <class 'models.message.Message'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 12, in __str__
    return self.title
           └ <Message: 9>

AttributeError: 'Message' object has no attribute 'title'
ERROR    2022-03-19 20:24:23.452 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x107b09a20>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x107b09ab0>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104f19900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104e17d00>
           └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104e17370>
    └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104f0f4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
    │    └ <function subprocess_started at 0x105d26e60>
    └ <SpawnProcess name='SpawnProcess-21' parent=78582 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104f0f520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105d26200>
           │       │   └ <uvicorn.server.Server object at 0x104f0f520>
           │       └ <function run at 0x1059c5240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105c7ec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1059c3520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1059c3490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1059c5000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10596fd90>
    └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x10909f640>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105de55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105de5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d85a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105de1180>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105d85a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10909f8e0>
          └ <fastapi.applications.FastAPI object at 0x105de1180>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1090c8160>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10909f8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1090f53f0>
                     │    │             └ <starlette.requests.Request object at 0x109110550>
                     │    └ <function exception_handling at 0x10908bac0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 20, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x109110550>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1090f53f0>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'Message' object has no attribute 'title'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x107b0a200>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x107be8c20>
          │    │   │      └ <starlette.requests.Request object at 0x109110550>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10909f820>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10909f850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10909f790>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10909f820>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105de1240>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10909f790>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x107d585e0>
          └ <fastapi.routing.APIRoute object at 0x1090677c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1090f63b0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1091104f0>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10904fb50>
          └ <fastapi.routing.APIRoute object at 0x1090677c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x109148130>
                     └ <function get_request_handler.<locals>.app at 0x10904fd00>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x107d59240>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x109148460>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10904edd0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1090678b0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x1080b03a0>
                 └ <repositories.message.MessageRepository object at 0x109148460>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1076e0790>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x107f37400>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
          │        └ <function Model.save at 0x107f36f80>
          └ <Message: 9>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
          │    └ <function Model._post_save at 0x107f36ef0>
          └ <Message: 9>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x1090c3c30>]
          │       └ <function gather at 0x1059a7880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 33, in signal_post_save
    print('message_post_save: ', sender, instance, using_db, update_fields)
                                 │       │         │         └ None
                                 │       │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10909ee00>
                                 │       └ <Message: 9>
                                 └ <class 'models.message.Message'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./models/message.py", line 12, in __str__
    return self.title
           └ <Message: 9>

AttributeError: 'Message' object has no attribute 'title'
INFO     2022-03-19 20:24:40.571 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:24:40.571 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:24:40.571 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:24:40.671 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:24:40.672 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:24:40.672 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:24:40.673 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:24:40.674 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:24:40.674 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:24:40.674 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:24:40.674 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:24:40.675 request id: app - uvicorn.server:serve - Finished server process [79126]
INFO     2022-03-19 20:24:40.675 request id: app - uvicorn.server:serve - Finished server process [79126]
INFO     2022-03-19 20:24:40.675 request id: app - uvicorn.server:serve - Finished server process [79126]
INFO     2022-03-19 20:24:41.107 request id: app - uvicorn.server:serve - Started server process [79153]
INFO     2022-03-19 20:24:41.107 request id: app - uvicorn.server:serve - Started server process [79153]
INFO     2022-03-19 20:24:41.108 request id: app - uvicorn.server:serve - Started server process [79153]
INFO     2022-03-19 20:24:41.108 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:24:41.108 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:24:41.108 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:24:41.114 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104bca020>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:24:41.114 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:24:41.115 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:41.115 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:41.115 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:24:42.893 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:24:42.900 request id: app - models.message:signal_post_save - new message 10 - string
INFO     2022-03-19 20:24:42.903 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60161 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:25:33.999 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:25:33.999 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:25:33.999 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:25:34.100 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:25:34.100 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:25:34.101 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:25:34.102 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:25:34.102 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:25:34.102 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:25:34.103 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:25:34.103 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:25:34.103 request id: app - uvicorn.server:serve - Finished server process [79153]
INFO     2022-03-19 20:25:34.103 request id: app - uvicorn.server:serve - Finished server process [79153]
INFO     2022-03-19 20:25:34.103 request id: app - uvicorn.server:serve - Finished server process [79153]
INFO     2022-03-19 20:25:34.483 request id: app - uvicorn.server:serve - Started server process [79178]
INFO     2022-03-19 20:25:34.483 request id: app - uvicorn.server:serve - Started server process [79178]
INFO     2022-03-19 20:25:34.484 request id: app - uvicorn.server:serve - Started server process [79178]
INFO     2022-03-19 20:25:34.484 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:25:34.484 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:25:34.484 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:25:34.489 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104c9f6d0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:25:34.489 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:25:34.490 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:25:34.490 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:25:34.490 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:25:41.063 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:25:41.063 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:25:41.063 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:25:41.164 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:25:41.165 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:25:41.165 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:25:41.166 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:25:41.166 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:25:41.166 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:25:41.166 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:25:41.167 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:25:41.167 request id: app - uvicorn.server:serve - Finished server process [79178]
INFO     2022-03-19 20:25:41.167 request id: app - uvicorn.server:serve - Finished server process [79178]
INFO     2022-03-19 20:25:41.167 request id: app - uvicorn.server:serve - Finished server process [79178]
INFO     2022-03-19 20:25:47.836 request id: app - uvicorn.server:serve - Started server process [79211]
INFO     2022-03-19 20:25:47.836 request id: app - uvicorn.server:serve - Started server process [79211]
INFO     2022-03-19 20:25:47.836 request id: app - uvicorn.server:serve - Started server process [79211]
INFO     2022-03-19 20:25:47.837 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:25:47.837 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:25:47.837 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:25:47.842 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x11122f4c0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:25:47.842 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:25:47.843 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:25:47.843 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:25:47.843 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:00.579 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:26:00.579 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:26:00.579 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:26:00.680 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:26:00.681 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:26:00.681 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:26:00.682 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:26:00.682 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:26:00.682 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:26:00.683 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:26:00.683 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:26:00.683 request id: app - uvicorn.server:serve - Finished server process [79211]
INFO     2022-03-19 20:26:00.683 request id: app - uvicorn.server:serve - Finished server process [79211]
INFO     2022-03-19 20:26:00.683 request id: app - uvicorn.server:serve - Finished server process [79211]
INFO     2022-03-19 20:26:01.071 request id: app - uvicorn.server:serve - Started server process [79233]
INFO     2022-03-19 20:26:01.071 request id: app - uvicorn.server:serve - Started server process [79233]
INFO     2022-03-19 20:26:01.071 request id: app - uvicorn.server:serve - Started server process [79233]
INFO     2022-03-19 20:26:01.071 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:26:01.071 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:26:01.072 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:26:01.077 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10549f6a0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:26:01.077 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:26:01.077 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:01.077 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:01.078 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:45.465 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:26:45.465 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:26:45.465 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:26:45.566 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:26:45.567 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:26:45.567 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:26:45.568 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:26:45.569 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:26:45.569 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:26:45.569 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:26:45.569 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:26:45.570 request id: app - uvicorn.server:serve - Finished server process [79233]
INFO     2022-03-19 20:26:45.570 request id: app - uvicorn.server:serve - Finished server process [79233]
INFO     2022-03-19 20:26:45.570 request id: app - uvicorn.server:serve - Finished server process [79233]
INFO     2022-03-19 20:26:46.007 request id: app - uvicorn.server:serve - Started server process [79273]
INFO     2022-03-19 20:26:46.007 request id: app - uvicorn.server:serve - Started server process [79273]
INFO     2022-03-19 20:26:46.007 request id: app - uvicorn.server:serve - Started server process [79273]
INFO     2022-03-19 20:26:46.007 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:26:46.007 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:26:46.007 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:26:46.015 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103ecf1f0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:26:46.015 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:26:46.016 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:46.016 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:46.016 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:26:48.182 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:26:48.190 request id: None - signals.message:signal_post_save - new message 11 - string
INFO     2022-03-19 20:26:48.192 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60183 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:27:12.911 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:27:12.912 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:27:12.912 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:27:13.013 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:27:13.013 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:27:13.013 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:27:13.015 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:27:13.015 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:27:13.015 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:27:13.016 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:27:13.016 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:27:13.016 request id: app - uvicorn.server:serve - Finished server process [79273]
INFO     2022-03-19 20:27:13.016 request id: app - uvicorn.server:serve - Finished server process [79273]
INFO     2022-03-19 20:27:13.016 request id: app - uvicorn.server:serve - Finished server process [79273]
INFO     2022-03-19 20:27:13.414 request id: app - uvicorn.server:serve - Started server process [79298]
INFO     2022-03-19 20:27:13.414 request id: app - uvicorn.server:serve - Started server process [79298]
INFO     2022-03-19 20:27:13.414 request id: app - uvicorn.server:serve - Started server process [79298]
INFO     2022-03-19 20:27:13.414 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:27:13.414 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:27:13.415 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:27:13.420 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10619fa30>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:27:13.420 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:27:13.421 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:27:13.421 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:27:13.422 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:27:34.299 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:27:34.307 request id: app - signals.message:signal_post_save - new message 12 - string
INFO     2022-03-19 20:27:34.309 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60201 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:28:10.852 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:10.853 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:10.853 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:10.954 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:10.954 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:10.954 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:10.955 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:28:10.956 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:28:10.956 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:10.956 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:10.956 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:10.956 request id: app - uvicorn.server:serve - Finished server process [79298]
INFO     2022-03-19 20:28:10.957 request id: app - uvicorn.server:serve - Finished server process [79298]
INFO     2022-03-19 20:28:10.957 request id: app - uvicorn.server:serve - Finished server process [79298]
INFO     2022-03-19 20:28:11.389 request id: app - uvicorn.server:serve - Started server process [79337]
INFO     2022-03-19 20:28:11.389 request id: app - uvicorn.server:serve - Started server process [79337]
INFO     2022-03-19 20:28:11.389 request id: app - uvicorn.server:serve - Started server process [79337]
INFO     2022-03-19 20:28:11.389 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:11.389 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:11.389 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:11.396 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103233b50>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:28:11.396 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:28:11.397 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:11.397 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:11.397 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:19.685 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:19.685 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:19.685 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:19.787 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:19.787 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:19.787 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:19.799 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:28:19.799 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:28:19.799 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:19.799 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:19.800 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:19.800 request id: app - uvicorn.server:serve - Finished server process [79337]
INFO     2022-03-19 20:28:19.800 request id: app - uvicorn.server:serve - Finished server process [79337]
INFO     2022-03-19 20:28:19.800 request id: app - uvicorn.server:serve - Finished server process [79337]
INFO     2022-03-19 20:28:20.179 request id: app - uvicorn.server:serve - Started server process [79355]
INFO     2022-03-19 20:28:20.179 request id: app - uvicorn.server:serve - Started server process [79355]
INFO     2022-03-19 20:28:20.179 request id: app - uvicorn.server:serve - Started server process [79355]
INFO     2022-03-19 20:28:20.179 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:20.179 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:20.179 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:20.185 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10570baf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:28:20.185 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:28:20.185 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:20.186 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:20.186 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:25.139 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:25.140 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:25.140 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:28:25.242 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:25.244 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:25.244 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:28:25.247 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:28:25.247 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:28:25.248 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:25.248 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:25.249 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:28:25.249 request id: app - uvicorn.server:serve - Finished server process [79355]
INFO     2022-03-19 20:28:25.249 request id: app - uvicorn.server:serve - Finished server process [79355]
INFO     2022-03-19 20:28:25.250 request id: app - uvicorn.server:serve - Finished server process [79355]
INFO     2022-03-19 20:28:27.366 request id: app - uvicorn.server:serve - Started server process [79375]
INFO     2022-03-19 20:28:27.367 request id: app - uvicorn.server:serve - Started server process [79375]
INFO     2022-03-19 20:28:27.367 request id: app - uvicorn.server:serve - Started server process [79375]
INFO     2022-03-19 20:28:27.367 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:27.367 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:27.367 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:28:27.381 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1079dbac0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:28:27.381 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:28:27.381 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:27.382 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:27.382 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:28:32.542 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:28:32.551 request id: app - signals.message:signal_post_save - new message 13 - string
INFO     2022-03-19 20:28:32.554 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60211 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:36:19.935 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:19.935 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:19.935 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:20.037 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:20.037 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:20.037 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:20.039 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:20.039 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:20.040 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:20.040 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:20.040 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:20.040 request id: app - uvicorn.server:serve - Finished server process [79375]
INFO     2022-03-19 20:36:20.041 request id: app - uvicorn.server:serve - Finished server process [79375]
INFO     2022-03-19 20:36:20.041 request id: app - uvicorn.server:serve - Finished server process [79375]
INFO     2022-03-19 20:36:20.490 request id: app - uvicorn.server:serve - Started server process [80180]
INFO     2022-03-19 20:36:20.490 request id: app - uvicorn.server:serve - Started server process [80180]
INFO     2022-03-19 20:36:20.490 request id: app - uvicorn.server:serve - Started server process [80180]
INFO     2022-03-19 20:36:20.491 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:20.491 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:20.491 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:20.499 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10379bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:36:20.499 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:36:20.500 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:20.500 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:20.501 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:24.343 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:24.344 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:24.344 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:24.445 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:24.445 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:24.446 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:24.447 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:24.447 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:24.447 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:24.447 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:24.447 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:24.447 request id: app - uvicorn.server:serve - Finished server process [80180]
INFO     2022-03-19 20:36:24.447 request id: app - uvicorn.server:serve - Finished server process [80180]
INFO     2022-03-19 20:36:24.448 request id: app - uvicorn.server:serve - Finished server process [80180]
INFO     2022-03-19 20:36:24.829 request id: app - uvicorn.server:serve - Started server process [80197]
INFO     2022-03-19 20:36:24.829 request id: app - uvicorn.server:serve - Started server process [80197]
INFO     2022-03-19 20:36:24.829 request id: app - uvicorn.server:serve - Started server process [80197]
INFO     2022-03-19 20:36:24.829 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:24.829 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:24.830 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:24.836 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10449bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:36:24.836 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:36:24.836 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:24.836 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:24.837 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:45.462 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:45.462 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:45.462 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:45.563 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:45.564 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:45.564 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:45.565 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:45.565 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:45.565 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:45.565 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:45.565 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:45.565 request id: app - uvicorn.server:serve - Finished server process [80197]
INFO     2022-03-19 20:36:45.566 request id: app - uvicorn.server:serve - Finished server process [80197]
INFO     2022-03-19 20:36:45.566 request id: app - uvicorn.server:serve - Finished server process [80197]
INFO     2022-03-19 20:36:45.952 request id: app - uvicorn.server:serve - Started server process [80231]
INFO     2022-03-19 20:36:45.952 request id: app - uvicorn.server:serve - Started server process [80231]
INFO     2022-03-19 20:36:45.952 request id: app - uvicorn.server:serve - Started server process [80231]
INFO     2022-03-19 20:36:45.953 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:45.953 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:45.953 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:45.959 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10499bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:36:45.960 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:36:45.960 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:45.960 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:45.960 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:51.723 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:51.723 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:51.723 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:36:51.824 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:51.825 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:51.825 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:36:51.830 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:51.830 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:36:51.831 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:51.831 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:51.831 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:36:51.831 request id: app - uvicorn.server:serve - Finished server process [80231]
INFO     2022-03-19 20:36:51.831 request id: app - uvicorn.server:serve - Finished server process [80231]
INFO     2022-03-19 20:36:51.832 request id: app - uvicorn.server:serve - Finished server process [80231]
INFO     2022-03-19 20:36:52.212 request id: app - uvicorn.server:serve - Started server process [80248]
INFO     2022-03-19 20:36:52.213 request id: app - uvicorn.server:serve - Started server process [80248]
INFO     2022-03-19 20:36:52.213 request id: app - uvicorn.server:serve - Started server process [80248]
INFO     2022-03-19 20:36:52.213 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:52.213 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:52.213 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:36:52.220 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x11019bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:36:52.220 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:36:52.221 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:52.221 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:36:52.221 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:37:43.370 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:37:43.370 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:37:43.370 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:37:43.471 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:37:43.472 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:37:43.472 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:37:43.473 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:37:43.473 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:37:43.473 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:37:43.474 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:37:43.474 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:37:43.474 request id: app - uvicorn.server:serve - Finished server process [80248]
INFO     2022-03-19 20:37:43.474 request id: app - uvicorn.server:serve - Finished server process [80248]
INFO     2022-03-19 20:37:43.474 request id: app - uvicorn.server:serve - Finished server process [80248]
INFO     2022-03-19 20:37:43.856 request id: app - uvicorn.server:serve - Started server process [80272]
INFO     2022-03-19 20:37:43.857 request id: app - uvicorn.server:serve - Started server process [80272]
INFO     2022-03-19 20:37:43.857 request id: app - uvicorn.server:serve - Started server process [80272]
INFO     2022-03-19 20:37:43.857 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:37:43.857 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:37:43.857 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:37:43.863 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x102c97af0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:37:43.863 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:37:43.864 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:37:43.864 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:37:43.864 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:38:21.070 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:38:21.070 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:38:21.070 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:38:21.172 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:38:21.172 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:38:21.172 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:38:21.173 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:38:21.173 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:38:21.173 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:38:21.174 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:38:21.174 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:38:21.174 request id: app - uvicorn.server:serve - Finished server process [80272]
INFO     2022-03-19 20:38:21.174 request id: app - uvicorn.server:serve - Finished server process [80272]
INFO     2022-03-19 20:38:21.174 request id: app - uvicorn.server:serve - Finished server process [80272]
INFO     2022-03-19 20:38:21.552 request id: app - uvicorn.server:serve - Started server process [80301]
INFO     2022-03-19 20:38:21.552 request id: app - uvicorn.server:serve - Started server process [80301]
INFO     2022-03-19 20:38:21.552 request id: app - uvicorn.server:serve - Started server process [80301]
INFO     2022-03-19 20:38:21.552 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:38:21.552 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:38:21.552 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:38:21.558 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10356baf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:38:21.558 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:38:21.558 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:38:21.558 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:38:21.559 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:48:30.314 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:48:30.314 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:48:30.314 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:48:30.416 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:48:30.416 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:48:30.416 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:48:30.417 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:48:30.417 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:48:30.418 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:48:30.418 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:48:30.418 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:48:30.418 request id: app - uvicorn.server:serve - Finished server process [80301]
INFO     2022-03-19 20:48:30.418 request id: app - uvicorn.server:serve - Finished server process [80301]
INFO     2022-03-19 20:48:30.418 request id: app - uvicorn.server:serve - Finished server process [80301]
INFO     2022-03-19 20:48:30.825 request id: app - uvicorn.server:serve - Started server process [80381]
INFO     2022-03-19 20:48:30.825 request id: app - uvicorn.server:serve - Started server process [80381]
INFO     2022-03-19 20:48:30.825 request id: app - uvicorn.server:serve - Started server process [80381]
INFO     2022-03-19 20:48:30.825 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:48:30.826 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:48:30.826 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:48:30.833 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:48:30.833 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:48:30.834 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:48:30.834 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:48:30.834 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:48:32.811 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:48:32.815 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60431 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:48:32.817 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x106261ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x106261b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102d41900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102c3fd00>
           └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102c3f370>
    └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102d374c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
    │    └ <function subprocess_started at 0x105802e60>
    └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102d37520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105802200>
           │       │   └ <uvicorn.server.Server object at 0x102d37520>
           │       └ <function run at 0x1030f1240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103f36c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1030ef520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030ef490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030f1000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10309bd90>
    └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1058c15a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1058c1630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105861a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1058bd210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105861a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x12019b910>
          └ <fastapi.applications.FastAPI object at 0x1058bd210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1201c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x12019b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1201f5870>
                     │    │             └ <starlette.requests.Request object at 0x1202149a0>
                     │    └ <function exception_handling at 0x12018bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1202149a0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1201f5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x106262290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x106338e50>
          │    │   │      └ <starlette.requests.Request object at 0x1202149a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x12019b850>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x12019b7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x12019b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1058bd270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x12019b7c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x106558670>
          └ <fastapi.routing.APIRoute object at 0x120167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x12014fc70>
          └ <fastapi.routing.APIRoute object at 0x120167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1202445b0>
                     └ <function get_request_handler.<locals>.app at 0x12014fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1065592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1202448b0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x12014eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x120167a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107018550>
                 └ <repositories.message.MessageRepository object at 0x1202448b0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x105e346c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x106733490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>
          │        └ <function Model.save at 0x106733010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>
          │    └ <function Model._pre_save at 0x106732ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1201bfd80>]
          │       └ <function gather at 0x1030d3880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender,
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x102ef53f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>, None)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x102ef5990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x102ef5a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x102ef5c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x102ef40d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x106797370>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x102ef2710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>, None)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:48:32.832 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x106261ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x106261b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102d41900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102c3fd00>
           └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102c3f370>
    └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102d374c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
    │    └ <function subprocess_started at 0x105802e60>
    └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102d37520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105802200>
           │       │   └ <uvicorn.server.Server object at 0x102d37520>
           │       └ <function run at 0x1030f1240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103f36c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1030ef520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030ef490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030f1000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10309bd90>
    └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1058c15a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1058c1630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105861a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1058bd210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105861a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x12019b910>
          └ <fastapi.applications.FastAPI object at 0x1058bd210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1201c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x12019b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1201f5870>
                     │    │             └ <starlette.requests.Request object at 0x1202149a0>
                     │    └ <function exception_handling at 0x12018bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1202149a0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1201f5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x106262290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x106338e50>
          │    │   │      └ <starlette.requests.Request object at 0x1202149a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x12019b850>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x12019b7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x12019b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1058bd270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x12019b7c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x106558670>
          └ <fastapi.routing.APIRoute object at 0x120167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x12014fc70>
          └ <fastapi.routing.APIRoute object at 0x120167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1202445b0>
                     └ <function get_request_handler.<locals>.app at 0x12014fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1065592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1202448b0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x12014eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x120167a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107018550>
                 └ <repositories.message.MessageRepository object at 0x1202448b0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x105e346c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x106733490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>
          │        └ <function Model.save at 0x106733010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>
          │    └ <function Model._pre_save at 0x106732ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1201bfd80>]
          │       └ <function gather at 0x1030d3880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender,
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x102ef53f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>, None)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x102ef5990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x102ef5a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x102ef5c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x102ef40d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x106797370>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x102ef2710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>, None)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:48:32.840 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x106261ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x106261b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102d41900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102c3fd00>
           └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102c3f370>
    └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102d374c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
    │    └ <function subprocess_started at 0x105802e60>
    └ <SpawnProcess name='SpawnProcess-8' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102d37520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105802200>
           │       │   └ <uvicorn.server.Server object at 0x102d37520>
           │       └ <function run at 0x1030f1240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103f36c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1030ef520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1030ef490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1030f1000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x10309bd90>
    └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x120244df0>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1058c15a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x1058c1630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105861a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x1058bd210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105861a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x12019b910>
          └ <fastapi.applications.FastAPI object at 0x1058bd210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1201c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x12019b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1201f5870>
                     │    │             └ <starlette.requests.Request object at 0x1202149a0>
                     │    └ <function exception_handling at 0x12018bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1202149a0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1201f5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x106262290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x106338e50>
          │    │   │      └ <starlette.requests.Request object at 0x1202149a0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x12019b850>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x12019b880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x12019b7c0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x12019b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x1058bd270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x12019b7c0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x106558670>
          └ <fastapi.routing.APIRoute object at 0x120167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1201f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x120214940>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x12014fc70>
          └ <fastapi.routing.APIRoute object at 0x120167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1202445b0>
                     └ <function get_request_handler.<locals>.app at 0x12014fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1065592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1202448b0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x12014eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x120167a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107018550>
                 └ <repositories.message.MessageRepository object at 0x1202448b0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x105e346c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x106733490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>
          │        └ <function Model.save at 0x106733010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>
          │    └ <function Model._pre_save at 0x106732ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1201bfd80>]
          │       └ <function gather at 0x1030d3880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender,
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x102ef53f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>, None)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x102ef5990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x102ef5a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x102ef5c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x102ef40d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x106797370>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x102ef2710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x12019bb20>, None)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
INFO     2022-03-19 20:49:10.688 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:49:10.688 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:49:10.689 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:49:10.790 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:49:10.790 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:49:10.790 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:49:10.792 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:49:10.792 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:49:10.792 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:49:10.792 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:49:10.792 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:49:10.792 request id: app - uvicorn.server:serve - Finished server process [80381]
INFO     2022-03-19 20:49:10.793 request id: app - uvicorn.server:serve - Finished server process [80381]
INFO     2022-03-19 20:49:10.793 request id: app - uvicorn.server:serve - Finished server process [80381]
INFO     2022-03-19 20:49:11.226 request id: app - uvicorn.server:serve - Started server process [80406]
INFO     2022-03-19 20:49:11.226 request id: app - uvicorn.server:serve - Started server process [80406]
INFO     2022-03-19 20:49:11.226 request id: app - uvicorn.server:serve - Started server process [80406]
INFO     2022-03-19 20:49:11.226 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:49:11.226 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:49:11.227 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:49:11.233 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:49:11.233 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:49:11.233 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:49:11.234 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:49:11.234 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:49:13.620 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:49:13.625 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60443 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:49:13.628 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x102d1dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x102d1db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x101315900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x101267d00>
           └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x101267370>
    └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10130b4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
    │    └ <function subprocess_started at 0x101f8ae60>
    └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10130b520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x101f8a200>
           │       │   └ <uvicorn.server.Server object at 0x10130b520>
           │       └ <function run at 0x1016ed240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x101f32c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1016eb520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1016eb490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1016ed000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101697d90>
    └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1020495a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x102049630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101fe9a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x102045210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101fe9a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104d9ba00>
          └ <fastapi.applications.FastAPI object at 0x102045210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104dc45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104d9ba00>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x104df5870>
                     │    │             └ <starlette.requests.Request object at 0x104e149d0>
                     │    └ <function exception_handling at 0x104d8bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x104e149d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x104df5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x102d1e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x102df4ef0>
          │    │   │      └ <starlette.requests.Request object at 0x104e149d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x104d9b940>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104d9b8b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x104d9b940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x102045270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104d9b8b0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x102e58670>
          └ <fastapi.routing.APIRoute object at 0x104d67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x104d4fc70>
          └ <fastapi.routing.APIRoute object at 0x104d67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104e405e0>
                     └ <function get_request_handler.<locals>.app at 0x104d4fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102e592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x104e408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x104d4eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x104d67a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x103118550>
                 └ <repositories.message.MessageRepository object at 0x104e408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1028f06c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x103033490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>
          │        └ <function Model.save at 0x103033010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>
          │    └ <function Model._pre_save at 0x103032ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x104dbfd80>]
          │       └ <function gather at 0x1016cf880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender,
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x1014f13f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>, None)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x1014f1990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x1014f1a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x1014f1c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1014f00d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x103093520>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x1014ee710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>, None)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:49:13.644 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x102d1dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x102d1db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x101315900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x101267d00>
           └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x101267370>
    └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10130b4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
    │    └ <function subprocess_started at 0x101f8ae60>
    └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10130b520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x101f8a200>
           │       │   └ <uvicorn.server.Server object at 0x10130b520>
           │       └ <function run at 0x1016ed240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x101f32c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1016eb520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1016eb490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1016ed000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101697d90>
    └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1020495a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x102049630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101fe9a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x102045210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101fe9a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104d9ba00>
          └ <fastapi.applications.FastAPI object at 0x102045210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104dc45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104d9ba00>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x104df5870>
                     │    │             └ <starlette.requests.Request object at 0x104e149d0>
                     │    └ <function exception_handling at 0x104d8bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x104e149d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x104df5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x102d1e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x102df4ef0>
          │    │   │      └ <starlette.requests.Request object at 0x104e149d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x104d9b940>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104d9b8b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x104d9b940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x102045270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104d9b8b0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x102e58670>
          └ <fastapi.routing.APIRoute object at 0x104d67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x104d4fc70>
          └ <fastapi.routing.APIRoute object at 0x104d67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104e405e0>
                     └ <function get_request_handler.<locals>.app at 0x104d4fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102e592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x104e408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x104d4eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x104d67a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x103118550>
                 └ <repositories.message.MessageRepository object at 0x104e408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1028f06c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x103033490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>
          │        └ <function Model.save at 0x103033010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>
          │    └ <function Model._pre_save at 0x103032ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x104dbfd80>]
          │       └ <function gather at 0x1016cf880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender,
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x1014f13f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>, None)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x1014f1990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x1014f1a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x1014f1c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1014f00d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x103093520>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x1014ee710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>, None)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:49:13.652 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x102d1dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x102d1db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x101315900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x101267d00>
           └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x101267370>
    └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x10130b4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
    │    └ <function subprocess_started at 0x101f8ae60>
    └ <SpawnProcess name='SpawnProcess-9' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x10130b520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x101f8a200>
           │       │   └ <uvicorn.server.Server object at 0x10130b520>
           │       └ <function run at 0x1016ed240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x101f32c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1016eb520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1016eb490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1016ed000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x101697d90>
    └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x104e40e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1020495a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x102049630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101fe9a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x102045210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x101fe9a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104d9ba00>
          └ <fastapi.applications.FastAPI object at 0x102045210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x104dc45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x104d9ba00>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x104df5870>
                     │    │             └ <starlette.requests.Request object at 0x104e149d0>
                     │    └ <function exception_handling at 0x104d8bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x104e149d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x104df5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x102d1e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x102df4ef0>
          │    │   │      └ <starlette.requests.Request object at 0x104e149d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x104d9b940>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x104d9b970>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104d9b8b0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x104d9b940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x102045270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x104d9b8b0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x102e58670>
          └ <fastapi.routing.APIRoute object at 0x104d67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x104df6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x104e14970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x104d4fc70>
          └ <fastapi.routing.APIRoute object at 0x104d67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x104e405e0>
                     └ <function get_request_handler.<locals>.app at 0x104d4fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x102e592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x104e408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x104d4eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x104d67a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x103118550>
                 └ <repositories.message.MessageRepository object at 0x104e408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1028f06c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x103033490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>
          │        └ <function Model.save at 0x103033010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>
          │    └ <function Model._pre_save at 0x103032ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x104dbfd80>]
          │       └ <function gather at 0x1016cf880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender,
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x1014f13f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>, None)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x1014f1990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x1014f1a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x1014f1c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1014f00d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x103093520>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x1014ee710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<class 'models.message.Message'>, <Message>, <tortoise.backends.sqlite.client.SqliteClient object at 0x104d9bb20>, None)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
INFO     2022-03-19 20:49:35.917 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:49:35.917 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:49:35.917 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:49:36.019 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:49:36.019 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:49:36.019 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:49:36.020 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:49:36.020 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:49:36.020 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:49:36.020 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:49:36.020 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:49:36.021 request id: app - uvicorn.server:serve - Finished server process [80406]
INFO     2022-03-19 20:49:36.021 request id: app - uvicorn.server:serve - Finished server process [80406]
INFO     2022-03-19 20:49:36.021 request id: app - uvicorn.server:serve - Finished server process [80406]
INFO     2022-03-19 20:49:36.400 request id: app - uvicorn.server:serve - Started server process [80431]
INFO     2022-03-19 20:49:36.400 request id: app - uvicorn.server:serve - Started server process [80431]
INFO     2022-03-19 20:49:36.400 request id: app - uvicorn.server:serve - Started server process [80431]
INFO     2022-03-19 20:49:36.401 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:49:36.401 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:49:36.401 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:49:36.407 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10549bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:49:36.407 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:49:36.408 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:49:36.408 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:49:36.408 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:49:37.780 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:49:37.790 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60451 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:50:24.544 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:50:24.544 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:50:24.544 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:50:24.646 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:50:24.646 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:50:24.646 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:50:24.661 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:50:24.662 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:50:24.662 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:50:24.662 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:50:24.662 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:50:24.662 request id: app - uvicorn.server:serve - Finished server process [80431]
INFO     2022-03-19 20:50:24.662 request id: app - uvicorn.server:serve - Finished server process [80431]
INFO     2022-03-19 20:50:24.662 request id: app - uvicorn.server:serve - Finished server process [80431]
INFO     2022-03-19 20:50:25.047 request id: app - uvicorn.server:serve - Started server process [80456]
INFO     2022-03-19 20:50:25.047 request id: app - uvicorn.server:serve - Started server process [80456]
INFO     2022-03-19 20:50:25.047 request id: app - uvicorn.server:serve - Started server process [80456]
INFO     2022-03-19 20:50:25.047 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:50:25.047 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:50:25.047 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:50:25.057 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:50:25.057 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:50:25.059 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:50:25.059 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:50:25.059 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:50:42.348 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:50:42.350 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60464 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:50:42.350 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x104d1dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x104d1db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1031b5900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1030ebd00>
           └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1030eb370>
    └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1031ab4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
    │    └ <function subprocess_started at 0x103e0ee60>
    └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1031ab520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103e0e200>
           │       │   └ <uvicorn.server.Server object at 0x1031ab520>
           │       └ <function run at 0x103551240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103db6c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x10354f520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10354f490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103551000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1034fbd90>
    └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103ecd5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103ecd630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103e6da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103ec9210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103e6da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10619b9a0>
          └ <fastapi.applications.FastAPI object at 0x103ec9210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1061c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10619b9a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1061f9870>
                     │    │             └ <starlette.requests.Request object at 0x1101149d0>
                     │    └ <function exception_handling at 0x10618fbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1101149d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1061f9870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x104d1e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104df4ef0>
          │    │   │      └ <starlette.requests.Request object at 0x1101149d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10619b8e0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10619b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10619b8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103ec9270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10619b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x104e58670>
          └ <fastapi.routing.APIRoute object at 0x106167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10614fc70>
          └ <fastapi.routing.APIRoute object at 0x106167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1101405b0>
                     └ <function get_request_handler.<locals>.app at 0x10614fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1101408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10614eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x106167a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x105104550>
                 └ <repositories.message.MessageRepository object at 0x1101408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1047706c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x105033490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>
          │        └ <function Model.save at 0x105033010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>
          │    └ <function Model._pre_save at 0x105032ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1061c3d80>]
          │       └ <function gather at 0x103533880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info("message_pre_save: ", instance)
    │      │                          └ <Message>
    │      └ <function Logger.info at 0x1033553f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<Message>,)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x103355990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x103355a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x103355c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1033540d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x105093520>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x103352710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<Message>,)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:50:42.358 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x104d1dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x104d1db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1031b5900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1030ebd00>
           └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1030eb370>
    └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1031ab4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
    │    └ <function subprocess_started at 0x103e0ee60>
    └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1031ab520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103e0e200>
           │       │   └ <uvicorn.server.Server object at 0x1031ab520>
           │       └ <function run at 0x103551240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103db6c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x10354f520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10354f490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103551000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1034fbd90>
    └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103ecd5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103ecd630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103e6da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103ec9210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103e6da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10619b9a0>
          └ <fastapi.applications.FastAPI object at 0x103ec9210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1061c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10619b9a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1061f9870>
                     │    │             └ <starlette.requests.Request object at 0x1101149d0>
                     │    └ <function exception_handling at 0x10618fbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1101149d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1061f9870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x104d1e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104df4ef0>
          │    │   │      └ <starlette.requests.Request object at 0x1101149d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10619b8e0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10619b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10619b8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103ec9270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10619b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x104e58670>
          └ <fastapi.routing.APIRoute object at 0x106167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10614fc70>
          └ <fastapi.routing.APIRoute object at 0x106167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1101405b0>
                     └ <function get_request_handler.<locals>.app at 0x10614fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1101408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10614eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x106167a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x105104550>
                 └ <repositories.message.MessageRepository object at 0x1101408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1047706c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x105033490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>
          │        └ <function Model.save at 0x105033010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>
          │    └ <function Model._pre_save at 0x105032ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1061c3d80>]
          │       └ <function gather at 0x103533880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info("message_pre_save: ", instance)
    │      │                          └ <Message>
    │      └ <function Logger.info at 0x1033553f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<Message>,)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x103355990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x103355a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x103355c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1033540d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x105093520>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x103352710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<Message>,)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:50:42.366 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x104d1dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x104d1db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x1031b5900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x1030ebd00>
           └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x1030eb370>
    └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1031ab4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
    │    └ <function subprocess_started at 0x103e0ee60>
    └ <SpawnProcess name='SpawnProcess-11' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x1031ab520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103e0e200>
           │       │   └ <uvicorn.server.Server object at 0x1031ab520>
           │       └ <function run at 0x103551240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103db6c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x10354f520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x10354f490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x103551000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1034fbd90>
    └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x110140e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103ecd5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103ecd630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103e6da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103ec9210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103e6da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10619b9a0>
          └ <fastapi.applications.FastAPI object at 0x103ec9210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1061c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x10619b9a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1061f9870>
                     │    │             └ <starlette.requests.Request object at 0x1101149d0>
                     │    └ <function exception_handling at 0x10618fbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1101149d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1061f9870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x104d1e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104df4ef0>
          │    │   │      └ <starlette.requests.Request object at 0x1101149d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x10619b8e0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x10619b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10619b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x10619b8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103ec9270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x10619b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x104e58670>
          └ <fastapi.routing.APIRoute object at 0x106167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1061fa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110114970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x10614fc70>
          └ <fastapi.routing.APIRoute object at 0x106167910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1101405b0>
                     └ <function get_request_handler.<locals>.app at 0x10614fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104e592d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1101408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x10614eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x106167a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x105104550>
                 └ <repositories.message.MessageRepository object at 0x1101408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1047706c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x105033490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>
          │        └ <function Model.save at 0x105033010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x10619bb20>
          │    └ <function Model._pre_save at 0x105032ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x1061c3d80>]
          │       └ <function gather at 0x103533880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info("message_pre_save: ", instance)
    │      │                          └ <Message>
    │      └ <function Logger.info at 0x1033553f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (<Message>,)
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x103355990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x103355a20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x103355c60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1033540d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x105093520>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x103352710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (<Message>,)
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
INFO     2022-03-19 20:51:05.123 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:05.123 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:05.123 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:05.224 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:05.225 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:05.225 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:05.226 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:05.226 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:05.226 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:05.226 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:05.227 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:05.227 request id: app - uvicorn.server:serve - Finished server process [80456]
INFO     2022-03-19 20:51:05.227 request id: app - uvicorn.server:serve - Finished server process [80456]
INFO     2022-03-19 20:51:05.227 request id: app - uvicorn.server:serve - Finished server process [80456]
INFO     2022-03-19 20:51:05.604 request id: app - uvicorn.server:serve - Started server process [80483]
INFO     2022-03-19 20:51:05.604 request id: app - uvicorn.server:serve - Started server process [80483]
INFO     2022-03-19 20:51:05.604 request id: app - uvicorn.server:serve - Started server process [80483]
INFO     2022-03-19 20:51:05.604 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:05.604 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:05.605 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:05.610 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:51:05.610 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:51:05.611 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:05.611 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:05.611 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:07.724 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:51:07.726 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60467 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:51:07.726 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1049e1ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1049e1b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x103091900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102fe3d00>
           └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102fe3370>
    └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1030874c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
    │    └ <function subprocess_started at 0x103d06e60>
    └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103087520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103d06200>
           │       │   └ <uvicorn.server.Server object at 0x103087520>
           │       └ <function run at 0x1033fd240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103caec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1033fb520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033fb490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1033fd000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1033a7d90>
    └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103dc55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103dc5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103d65a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103dc1210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103d65a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105527a60>
          └ <fastapi.applications.FastAPI object at 0x103dc1210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1055505e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105527a60>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105585870>
                     │    │             └ <starlette.requests.Request object at 0x1055a09d0>
                     │    └ <function exception_handling at 0x105517be0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1055a09d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105585870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError("'dict' object is not callable")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1049e2290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104ab8d10>
          │    │   │      └ <starlette.requests.Request object at 0x1055a09d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1055279a0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105527910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1055279a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103dc1270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105527910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x104b1c670>
          └ <fastapi.routing.APIRoute object at 0x1054f3910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1054dbc70>
          └ <fastapi.routing.APIRoute object at 0x1054f3910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1055cc5e0>
                     └ <function get_request_handler.<locals>.app at 0x1054dbe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104b1d2d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x104d2f130>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x1054daef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1054f3a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x104ddc550>
                 └ <repositories.message.MessageRepository object at 0x104d2f130>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1045b46c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x104cf7490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>
          │        └ <function Model.save at 0x104cf7010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>
          │    └ <function Model._pre_save at 0x104cf6ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x10554fd80>]
          │       └ <function gather at 0x1033df880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info("message_pre_save: ", instance.__dict__())
    │      │                          │        └ <attribute '__dict__' of 'Model' objects>
    │      │                          └ <Message>
    │      └ <function Logger.info at 0x1032053f0>
    └ <Logger signals.message (NOTSET)>

TypeError: 'dict' object is not callable
ERROR    2022-03-19 20:51:07.737 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1049e1ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1049e1b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x103091900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102fe3d00>
           └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102fe3370>
    └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1030874c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
    │    └ <function subprocess_started at 0x103d06e60>
    └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103087520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103d06200>
           │       │   └ <uvicorn.server.Server object at 0x103087520>
           │       └ <function run at 0x1033fd240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103caec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1033fb520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033fb490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1033fd000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1033a7d90>
    └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103dc55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103dc5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103d65a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103dc1210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103d65a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105527a60>
          └ <fastapi.applications.FastAPI object at 0x103dc1210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1055505e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105527a60>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105585870>
                     │    │             └ <starlette.requests.Request object at 0x1055a09d0>
                     │    └ <function exception_handling at 0x105517be0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1055a09d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105585870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError("'dict' object is not callable")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1049e2290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104ab8d10>
          │    │   │      └ <starlette.requests.Request object at 0x1055a09d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1055279a0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105527910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1055279a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103dc1270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105527910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x104b1c670>
          └ <fastapi.routing.APIRoute object at 0x1054f3910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1054dbc70>
          └ <fastapi.routing.APIRoute object at 0x1054f3910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1055cc5e0>
                     └ <function get_request_handler.<locals>.app at 0x1054dbe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104b1d2d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x104d2f130>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x1054daef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1054f3a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x104ddc550>
                 └ <repositories.message.MessageRepository object at 0x104d2f130>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1045b46c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x104cf7490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>
          │        └ <function Model.save at 0x104cf7010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>
          │    └ <function Model._pre_save at 0x104cf6ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x10554fd80>]
          │       └ <function gather at 0x1033df880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info("message_pre_save: ", instance.__dict__())
    │      │                          │        └ <attribute '__dict__' of 'Model' objects>
    │      │                          └ <Message>
    │      └ <function Logger.info at 0x1032053f0>
    └ <Logger signals.message (NOTSET)>

TypeError: 'dict' object is not callable
ERROR    2022-03-19 20:51:07.744 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1049e1ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1049e1b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x103091900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102fe3d00>
           └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102fe3370>
    └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x1030874c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
    │    └ <function subprocess_started at 0x103d06e60>
    └ <SpawnProcess name='SpawnProcess-12' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x103087520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103d06200>
           │       │   └ <uvicorn.server.Server object at 0x103087520>
           │       └ <function run at 0x1033fd240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103caec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1033fb520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1033fb490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1033fd000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1033a7d90>
    └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1055cce20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103dc55a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103dc5630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103d65a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103dc1210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103d65a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105527a60>
          └ <fastapi.applications.FastAPI object at 0x103dc1210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1055505e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x105527a60>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105585870>
                     │    │             └ <starlette.requests.Request object at 0x1055a09d0>
                     │    └ <function exception_handling at 0x105517be0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1055a09d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105585870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError("'dict' object is not callable")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1049e2290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104ab8d10>
          │    │   │      └ <starlette.requests.Request object at 0x1055a09d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1055279a0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1055279d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105527910>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1055279a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103dc1270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x105527910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x104b1c670>
          └ <fastapi.routing.APIRoute object at 0x1054f3910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x105586830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x1055a0970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1054dbc70>
          └ <fastapi.routing.APIRoute object at 0x1054f3910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1055cc5e0>
                     └ <function get_request_handler.<locals>.app at 0x1054dbe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x104b1d2d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x104d2f130>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x1054daef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1054f3a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x104ddc550>
                 └ <repositories.message.MessageRepository object at 0x104d2f130>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1045b46c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x104cf7490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>
          │        └ <function Model.save at 0x104cf7010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x105527b20>
          │    └ <function Model._pre_save at 0x104cf6ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x10554fd80>]
          │       └ <function gather at 0x1033df880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info("message_pre_save: ", instance.__dict__())
    │      │                          │        └ <attribute '__dict__' of 'Model' objects>
    │      │                          └ <Message>
    │      └ <function Logger.info at 0x1032053f0>
    └ <Logger signals.message (NOTSET)>

TypeError: 'dict' object is not callable
INFO     2022-03-19 20:51:12.706 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:12.706 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:12.706 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:12.807 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:12.807 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:12.807 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:12.808 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:12.809 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:12.809 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:12.809 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:12.809 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:12.809 request id: app - uvicorn.server:serve - Finished server process [80483]
INFO     2022-03-19 20:51:12.809 request id: app - uvicorn.server:serve - Finished server process [80483]
INFO     2022-03-19 20:51:12.809 request id: app - uvicorn.server:serve - Finished server process [80483]
INFO     2022-03-19 20:51:13.187 request id: app - uvicorn.server:serve - Started server process [80506]
INFO     2022-03-19 20:51:13.187 request id: app - uvicorn.server:serve - Started server process [80506]
INFO     2022-03-19 20:51:13.187 request id: app - uvicorn.server:serve - Started server process [80506]
INFO     2022-03-19 20:51:13.187 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:13.187 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:13.187 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:13.194 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10349bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:51:13.195 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:51:13.196 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:13.196 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:13.196 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:14.374 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:51:14.376 request id: app - signals.message:signal_pre_save - message_pre_save: 
INFO     2022-03-19 20:51:14.379 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60469 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:51:45.461 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:45.462 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:45.462 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:45.563 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:45.563 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:45.563 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:45.565 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:45.565 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:45.565 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:45.565 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:45.565 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:45.565 request id: app - uvicorn.server:serve - Finished server process [80506]
INFO     2022-03-19 20:51:45.566 request id: app - uvicorn.server:serve - Finished server process [80506]
INFO     2022-03-19 20:51:45.566 request id: app - uvicorn.server:serve - Finished server process [80506]
INFO     2022-03-19 20:51:45.983 request id: app - uvicorn.server:serve - Started server process [80524]
INFO     2022-03-19 20:51:45.983 request id: app - uvicorn.server:serve - Started server process [80524]
INFO     2022-03-19 20:51:45.983 request id: app - uvicorn.server:serve - Started server process [80524]
INFO     2022-03-19 20:51:45.984 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:45.984 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:45.984 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:45.990 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1035ffb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:51:45.991 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:51:45.991 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:45.991 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:45.991 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:54.581 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:54.581 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:54.581 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:51:54.683 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:54.683 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:54.683 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:51:54.684 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:54.685 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:51:54.685 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:54.685 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:54.685 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:51:54.685 request id: app - uvicorn.server:serve - Finished server process [80524]
INFO     2022-03-19 20:51:54.685 request id: app - uvicorn.server:serve - Finished server process [80524]
INFO     2022-03-19 20:51:54.685 request id: app - uvicorn.server:serve - Finished server process [80524]
INFO     2022-03-19 20:51:55.104 request id: app - uvicorn.server:serve - Started server process [80541]
INFO     2022-03-19 20:51:55.105 request id: app - uvicorn.server:serve - Started server process [80541]
INFO     2022-03-19 20:51:55.105 request id: app - uvicorn.server:serve - Started server process [80541]
INFO     2022-03-19 20:51:55.105 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:55.105 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:55.105 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:51:55.112 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10720bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:51:55.113 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:51:55.113 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:55.113 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:51:55.114 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:00.573 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:00.573 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:00.573 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:00.674 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:00.674 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:00.674 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:00.676 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:52:00.676 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:52:00.676 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:00.676 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:00.676 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:00.677 request id: app - uvicorn.server:serve - Finished server process [80541]
INFO     2022-03-19 20:52:00.677 request id: app - uvicorn.server:serve - Finished server process [80541]
INFO     2022-03-19 20:52:00.677 request id: app - uvicorn.server:serve - Finished server process [80541]
INFO     2022-03-19 20:52:01.068 request id: app - uvicorn.server:serve - Started server process [80559]
INFO     2022-03-19 20:52:01.068 request id: app - uvicorn.server:serve - Started server process [80559]
INFO     2022-03-19 20:52:01.068 request id: app - uvicorn.server:serve - Started server process [80559]
INFO     2022-03-19 20:52:01.068 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:01.068 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:01.069 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:01.074 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:52:01.074 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:52:01.075 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:01.075 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:01.075 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:03.424 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:52:03.437 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60480 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:52:03.438 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1072a5ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1072a5b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104e19900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104d6bd00>
           └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d6b370>
    └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104e0f4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
    │    └ <function subprocess_started at 0x105b52e60>
    └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104e0f520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105b52200>
           │       │   └ <uvicorn.server.Server object at 0x104e0f520>
           │       └ <function run at 0x105309240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105abec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x105307520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105307490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105309000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1052b3d90>
    └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105c115a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105c11630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105bb1a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c0d210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105bb1a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107f9b9d0>
          └ <fastapi.applications.FastAPI object at 0x105c0d210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107fc45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107f9b9d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x107ff9870>
                     │    │             └ <starlette.requests.Request object at 0x1108189d0>
                     │    └ <function exception_handling at 0x107f8bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1108189d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x107ff9870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'NoneType' object has no attribute '__dict__'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1072a6290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x10737ce50>
          │    │   │      └ <starlette.requests.Request object at 0x1108189d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x107f9b910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107f9b880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x107f9b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c0d270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107f9b880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1073e0670>
          └ <fastapi.routing.APIRoute object at 0x107f67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x107f4fc70>
          └ <fastapi.routing.APIRoute object at 0x107f67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1108445b0>
                     └ <function get_request_handler.<locals>.app at 0x107f4fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1073e12d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1108448e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x107f4eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x107f67a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107690550>
                 └ <repositories.message.MessageRepository object at 0x1108448e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x106e786c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x1075bb490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
          │        └ <function Model.save at 0x1075bb010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
          │    └ <function Model._pre_save at 0x1075baef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x107fc3d80>]
          │       └ <function gather at 0x1052eb880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 15, in signal_pre_save
    instance.__dict__, using_db.__dict__, update_fields.__dict__)
    │        │         │        │         └ None
    │        │         │        └ <attribute '__dict__' of 'BaseDBAsyncClient' objects>
    │        │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
    │        └ <attribute '__dict__' of 'Model' objects>
    └ <Message>

AttributeError: 'NoneType' object has no attribute '__dict__'
ERROR    2022-03-19 20:52:03.451 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1072a5ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1072a5b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104e19900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104d6bd00>
           └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d6b370>
    └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104e0f4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
    │    └ <function subprocess_started at 0x105b52e60>
    └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104e0f520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105b52200>
           │       │   └ <uvicorn.server.Server object at 0x104e0f520>
           │       └ <function run at 0x105309240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105abec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x105307520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105307490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105309000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1052b3d90>
    └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105c115a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105c11630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105bb1a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c0d210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105bb1a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107f9b9d0>
          └ <fastapi.applications.FastAPI object at 0x105c0d210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107fc45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107f9b9d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x107ff9870>
                     │    │             └ <starlette.requests.Request object at 0x1108189d0>
                     │    └ <function exception_handling at 0x107f8bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1108189d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x107ff9870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'NoneType' object has no attribute '__dict__'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1072a6290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x10737ce50>
          │    │   │      └ <starlette.requests.Request object at 0x1108189d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x107f9b910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107f9b880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x107f9b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c0d270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107f9b880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1073e0670>
          └ <fastapi.routing.APIRoute object at 0x107f67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x107f4fc70>
          └ <fastapi.routing.APIRoute object at 0x107f67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1108445b0>
                     └ <function get_request_handler.<locals>.app at 0x107f4fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1073e12d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1108448e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x107f4eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x107f67a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107690550>
                 └ <repositories.message.MessageRepository object at 0x1108448e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x106e786c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x1075bb490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
          │        └ <function Model.save at 0x1075bb010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
          │    └ <function Model._pre_save at 0x1075baef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x107fc3d80>]
          │       └ <function gather at 0x1052eb880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 15, in signal_pre_save
    instance.__dict__, using_db.__dict__, update_fields.__dict__)
    │        │         │        │         └ None
    │        │         │        └ <attribute '__dict__' of 'BaseDBAsyncClient' objects>
    │        │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
    │        └ <attribute '__dict__' of 'Model' objects>
    └ <Message>

AttributeError: 'NoneType' object has no attribute '__dict__'
ERROR    2022-03-19 20:52:03.458 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1072a5ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1072a5b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104e19900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104d6bd00>
           └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104d6b370>
    └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104e0f4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
    │    └ <function subprocess_started at 0x105b52e60>
    └ <SpawnProcess name='SpawnProcess-16' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104e0f520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105b52200>
           │       │   └ <uvicorn.server.Server object at 0x104e0f520>
           │       └ <function run at 0x105309240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105abec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x105307520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105307490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105309000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1052b3d90>
    └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x107f9b220>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105c115a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105c11630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105bb1a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c0d210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105bb1a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107f9b9d0>
          └ <fastapi.applications.FastAPI object at 0x105c0d210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x107fc45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x107f9b9d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x107ff9870>
                     │    │             └ <starlette.requests.Request object at 0x1108189d0>
                     │    └ <function exception_handling at 0x107f8bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1108189d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x107ff9870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ AttributeError("'NoneType' object has no attribute '__dict__'")
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1072a6290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x10737ce50>
          │    │   │      └ <starlette.requests.Request object at 0x1108189d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x107f9b910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x107f9b940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107f9b880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x107f9b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c0d270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x107f9b880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1073e0670>
          └ <fastapi.routing.APIRoute object at 0x107f67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x107ffa830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x110818970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x107f4fc70>
          └ <fastapi.routing.APIRoute object at 0x107f67910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1108445b0>
                     └ <function get_request_handler.<locals>.app at 0x107f4fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1073e12d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1108448e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x107f4eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x107f67a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107690550>
                 └ <repositories.message.MessageRepository object at 0x1108448e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x106e786c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x1075bb490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
          │        └ <function Model.save at 0x1075bb010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
          │    └ <function Model._pre_save at 0x1075baef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x107fc3d80>]
          │       └ <function gather at 0x1052eb880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 15, in signal_pre_save
    instance.__dict__, using_db.__dict__, update_fields.__dict__)
    │        │         │        │         └ None
    │        │         │        └ <attribute '__dict__' of 'BaseDBAsyncClient' objects>
    │        │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x107f9bb20>
    │        └ <attribute '__dict__' of 'Model' objects>
    └ <Message>

AttributeError: 'NoneType' object has no attribute '__dict__'
INFO     2022-03-19 20:52:25.251 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:25.251 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:25.252 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:25.353 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:25.353 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:25.353 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:25.355 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:52:25.355 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:52:25.355 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:25.355 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:25.355 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:25.355 request id: app - uvicorn.server:serve - Finished server process [80559]
INFO     2022-03-19 20:52:25.356 request id: app - uvicorn.server:serve - Finished server process [80559]
INFO     2022-03-19 20:52:25.356 request id: app - uvicorn.server:serve - Finished server process [80559]
INFO     2022-03-19 20:52:25.728 request id: app - uvicorn.server:serve - Started server process [80578]
INFO     2022-03-19 20:52:25.729 request id: app - uvicorn.server:serve - Started server process [80578]
INFO     2022-03-19 20:52:25.729 request id: app - uvicorn.server:serve - Started server process [80578]
INFO     2022-03-19 20:52:25.729 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:25.729 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:25.729 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:25.734 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x103487b20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:52:25.735 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:52:25.735 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:25.736 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:25.736 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:32.001 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:32.001 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:32.001 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:52:32.103 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:32.103 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:32.103 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:52:32.104 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:52:32.104 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:52:32.105 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:32.105 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:32.105 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:52:32.105 request id: app - uvicorn.server:serve - Finished server process [80578]
INFO     2022-03-19 20:52:32.105 request id: app - uvicorn.server:serve - Finished server process [80578]
INFO     2022-03-19 20:52:32.105 request id: app - uvicorn.server:serve - Finished server process [80578]
INFO     2022-03-19 20:52:32.484 request id: app - uvicorn.server:serve - Started server process [80595]
INFO     2022-03-19 20:52:32.484 request id: app - uvicorn.server:serve - Started server process [80595]
INFO     2022-03-19 20:52:32.484 request id: app - uvicorn.server:serve - Started server process [80595]
INFO     2022-03-19 20:52:32.484 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:32.484 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:32.484 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:52:32.490 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:52:32.490 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:52:32.491 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:32.491 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:32.491 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:52:34.214 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:52:34.222 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60486 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:52:34.223 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x104879ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x104879b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102f0d900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102e43d00>
           └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102e43370>
    └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102f034c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
    │    └ <function subprocess_started at 0x103d66e60>
    └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102f03520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103d66200>
           │       │   └ <uvicorn.server.Server object at 0x102f03520>
           │       └ <function run at 0x1032a9240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103d0ec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1032a7520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1032a7490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1032a9000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103253d90>
    └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103e255a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103e25630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103dc5a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103e21210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103dc5a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1052fb9d0>
          └ <fastapi.applications.FastAPI object at 0x103e21210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1053245e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1052fb9d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105359870>
                     │    │             └ <starlette.requests.Request object at 0x1053789d0>
                     │    └ <function exception_handling at 0x1052ebbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1053789d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105359870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x10487a290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104954ea0>
          │    │   │      └ <starlette.requests.Request object at 0x1053789d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1052fb910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1052fb880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1052fb910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103e21270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1052fb880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1049b8670>
          └ <fastapi.routing.APIRoute object at 0x1052c7910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1052abc70>
          └ <fastapi.routing.APIRoute object at 0x1052c7910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1053a45b0>
                     └ <function get_request_handler.<locals>.app at 0x1052abe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1049b92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1053a48e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x1052aaef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1052c7a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x104c68550>
                 └ <repositories.message.MessageRepository object at 0x1053a48e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1044506c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x104b93490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>
          │        └ <function Model.save at 0x104b93010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>
          │    └ <function Model._pre_save at 0x104b92ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x105323d80>]
          │       └ <function gather at 0x10328b880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender.__dict__,
    │      │                          │      └ <attribute '__dict__' of 'Model' objects>
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x1030ad3f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (mappingproxy({'__module__': 'models.message', '__str__': <function Message.__str__ at 0x104c68280>, '_meta': <tortoise.model...
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x1030ad990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x1030ada20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x1030adc60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1030ac0d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x104bfb370>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x1030aa710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (mappingproxy({'__module__': 'models.message', '__str__': <function Message.__str__ at 0x104c68280>, '_meta': <tortoise.model...
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:52:34.241 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x104879ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x104879b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102f0d900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102e43d00>
           └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102e43370>
    └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102f034c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
    │    └ <function subprocess_started at 0x103d66e60>
    └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102f03520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103d66200>
           │       │   └ <uvicorn.server.Server object at 0x102f03520>
           │       └ <function run at 0x1032a9240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103d0ec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1032a7520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1032a7490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1032a9000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103253d90>
    └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103e255a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103e25630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103dc5a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103e21210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103dc5a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1052fb9d0>
          └ <fastapi.applications.FastAPI object at 0x103e21210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1053245e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1052fb9d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105359870>
                     │    │             └ <starlette.requests.Request object at 0x1053789d0>
                     │    └ <function exception_handling at 0x1052ebbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1053789d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105359870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x10487a290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104954ea0>
          │    │   │      └ <starlette.requests.Request object at 0x1053789d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1052fb910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1052fb880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1052fb910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103e21270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1052fb880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1049b8670>
          └ <fastapi.routing.APIRoute object at 0x1052c7910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1052abc70>
          └ <fastapi.routing.APIRoute object at 0x1052c7910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1053a45b0>
                     └ <function get_request_handler.<locals>.app at 0x1052abe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1049b92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1053a48e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x1052aaef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1052c7a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x104c68550>
                 └ <repositories.message.MessageRepository object at 0x1053a48e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1044506c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x104b93490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>
          │        └ <function Model.save at 0x104b93010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>
          │    └ <function Model._pre_save at 0x104b92ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x105323d80>]
          │       └ <function gather at 0x10328b880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender.__dict__,
    │      │                          │      └ <attribute '__dict__' of 'Model' objects>
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x1030ad3f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (mappingproxy({'__module__': 'models.message', '__str__': <function Message.__str__ at 0x104c68280>, '_meta': <tortoise.model...
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x1030ad990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x1030ada20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x1030adc60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1030ac0d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x104bfb370>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x1030aa710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (mappingproxy({'__module__': 'models.message', '__str__': <function Message.__str__ at 0x104c68280>, '_meta': <tortoise.model...
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
ERROR    2022-03-19 20:52:34.249 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x104879ab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x104879b40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x102f0d900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x102e43d00>
           └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x102e43370>
    └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x102f034c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
    │    └ <function subprocess_started at 0x103d66e60>
    └ <SpawnProcess name='SpawnProcess-18' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x102f03520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x103d66200>
           │       │   └ <uvicorn.server.Server object at 0x102f03520>
           │       └ <function run at 0x1032a9240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x103d0ec00>
           │    └ <function BaseEventLoop.run_until_complete at 0x1032a7520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x1032a7490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x1032a9000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x103253d90>
    └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x1053a4e20>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x103e255a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x103e25630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103dc5a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x103e21210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x103dc5a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1052fb9d0>
          └ <fastapi.applications.FastAPI object at 0x103e21210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1053245e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x1052fb9d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105359870>
                     │    │             └ <starlette.requests.Request object at 0x1053789d0>
                     │    └ <function exception_handling at 0x1052ebbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1053789d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x105359870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('not all arguments converted during string formatting')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x10487a290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x104954ea0>
          │    │   │      └ <starlette.requests.Request object at 0x1053789d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x1052fb910>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x1052fb940>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1052fb880>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x1052fb910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x103e21270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x1052fb880>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1049b8670>
          └ <fastapi.routing.APIRoute object at 0x1052c7910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x10535a830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x105378970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x1052abc70>
          └ <fastapi.routing.APIRoute object at 0x1052c7910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1053a45b0>
                     └ <function get_request_handler.<locals>.app at 0x1052abe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1049b92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1053a48e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x1052aaef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x1052c7a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x104c68550>
                 └ <repositories.message.MessageRepository object at 0x1053a48e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x1044506c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x104b93490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>
          │        └ <function Model.save at 0x104b93010>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 935, in save
    await self._pre_save(db, update_fields)
          │    │         │   └ None
          │    │         └ <tortoise.backends.sqlite.client.SqliteClient object at 0x1052fbb20>
          │    └ <function Model._pre_save at 0x104b92ef0>
          └ <Message>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 883, in _pre_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_pre_save at 0x105323d80>]
          │       └ <function gather at 0x10328b880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 14, in signal_pre_save
    logger.info('message_pre_save: ', sender.__dict__,
    │      │                          │      └ <attribute '__dict__' of 'Model' objects>
    │      │                          └ <class 'models.message.Message'>
    │      └ <function Logger.info at 0x1030ad3f0>
    └ <Logger signals.message (NOTSET)>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1468, in info
    self._log(INFO, msg, args, **kwargs)
    │    │    │     │    │       └ {}
    │    │    │     │    └ (mappingproxy({'__module__': 'models.message', '__str__': <function Message.__str__ at 0x104c68280>, '_meta': <tortoise.model...
    │    │    │     └ 'message_pre_save: '
    │    │    └ 20
    │    └ <function Logger._log at 0x1030ad990>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1615, in _log
    self.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.handle at 0x1030ada20>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1625, in handle
    self.callHandlers(record)
    │    │            └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Logger.callHandlers at 0x1030adc60>
    └ <Logger signals.message (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 1687, in callHandlers
    hdlr.handle(record)
    │    │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function Handler.handle at 0x1030ac0d0>
    └ <InterceptHandler (NOTSET)>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 967, in handle
    self.emit(record)
    │    │    └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
    │    └ <function InterceptHandler.emit at 0x104bfb370>
    └ <InterceptHandler (NOTSET)>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/logging/__init__.py", line 34, in emit
    ).log(level, record.getMessage())
          │      │      └ <function LogRecord.getMessage at 0x1030aa710>
          │      └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'INFO'

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/logging/__init__.py", line 368, in getMessage
    msg = msg % self.args
          │     │    └ (mappingproxy({'__module__': 'models.message', '__str__': <function Message.__str__ at 0x104c68280>, '_meta': <tortoise.model...
          │     └ <LogRecord: signals.message, 20, /Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py, 14, "message_pre_save: ">
          └ 'message_pre_save: '

TypeError: not all arguments converted during string formatting
INFO     2022-03-19 20:53:03.760 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:03.760 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:03.760 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:03.862 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:03.862 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:03.862 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:03.863 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:53:03.863 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:53:03.864 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:03.864 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:03.864 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:03.864 request id: app - uvicorn.server:serve - Finished server process [80595]
INFO     2022-03-19 20:53:03.864 request id: app - uvicorn.server:serve - Finished server process [80595]
INFO     2022-03-19 20:53:03.864 request id: app - uvicorn.server:serve - Finished server process [80595]
INFO     2022-03-19 20:53:04.247 request id: app - uvicorn.server:serve - Started server process [80612]
INFO     2022-03-19 20:53:04.247 request id: app - uvicorn.server:serve - Started server process [80612]
INFO     2022-03-19 20:53:04.247 request id: app - uvicorn.server:serve - Started server process [80612]
INFO     2022-03-19 20:53:04.247 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:04.247 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:04.247 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:04.254 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x105207b20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:53:04.254 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:53:04.254 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:04.255 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:04.255 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:14.166 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:14.166 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:14.166 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:14.268 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:14.268 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:14.268 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:14.269 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:53:14.269 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:53:14.269 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:14.270 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:14.270 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:14.270 request id: app - uvicorn.server:serve - Finished server process [80612]
INFO     2022-03-19 20:53:14.270 request id: app - uvicorn.server:serve - Finished server process [80612]
INFO     2022-03-19 20:53:14.270 request id: app - uvicorn.server:serve - Finished server process [80612]
INFO     2022-03-19 20:53:14.658 request id: app - uvicorn.server:serve - Started server process [80631]
INFO     2022-03-19 20:53:14.659 request id: app - uvicorn.server:serve - Started server process [80631]
INFO     2022-03-19 20:53:14.659 request id: app - uvicorn.server:serve - Started server process [80631]
INFO     2022-03-19 20:53:14.659 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:14.659 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:14.659 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:14.665 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x102c9fb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:53:14.665 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:53:14.666 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:14.666 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:14.666 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:18.607 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:18.607 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:18.607 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:53:18.709 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:18.709 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:18.709 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:53:18.710 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:53:18.710 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:53:18.710 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:18.711 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:18.711 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:53:18.711 request id: app - uvicorn.server:serve - Finished server process [80631]
INFO     2022-03-19 20:53:18.711 request id: app - uvicorn.server:serve - Finished server process [80631]
INFO     2022-03-19 20:53:18.711 request id: app - uvicorn.server:serve - Finished server process [80631]
INFO     2022-03-19 20:53:19.091 request id: app - uvicorn.server:serve - Started server process [80648]
INFO     2022-03-19 20:53:19.091 request id: app - uvicorn.server:serve - Started server process [80648]
INFO     2022-03-19 20:53:19.091 request id: app - uvicorn.server:serve - Started server process [80648]
INFO     2022-03-19 20:53:19.091 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:19.091 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:19.091 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:53:19.097 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x105a9faf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:53:19.097 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:53:19.098 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:19.098 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:19.098 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:53:21.088 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:53:21.099 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60496 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 20:55:24.189 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:55:24.189 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:55:24.189 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:55:24.291 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:55:24.291 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:55:24.291 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:55:24.293 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:55:24.293 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:55:24.293 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:55:24.294 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:55:24.294 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:55:24.294 request id: app - uvicorn.server:serve - Finished server process [80648]
INFO     2022-03-19 20:55:24.294 request id: app - uvicorn.server:serve - Finished server process [80648]
INFO     2022-03-19 20:55:24.294 request id: app - uvicorn.server:serve - Finished server process [80648]
INFO     2022-03-19 20:55:24.681 request id: app - uvicorn.server:serve - Started server process [80701]
INFO     2022-03-19 20:55:24.682 request id: app - uvicorn.server:serve - Started server process [80701]
INFO     2022-03-19 20:55:24.682 request id: app - uvicorn.server:serve - Started server process [80701]
INFO     2022-03-19 20:55:24.682 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:55:24.682 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:55:24.682 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:55:24.688 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10389bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:55:24.688 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:55:24.689 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:55:24.689 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:55:24.689 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:55:33.080 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:55:33.081 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:55:33.081 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:55:33.182 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:55:33.182 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:55:33.182 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:55:33.183 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:55:33.184 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:55:33.184 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:55:33.184 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:55:33.184 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:55:33.184 request id: app - uvicorn.server:serve - Finished server process [80701]
INFO     2022-03-19 20:55:33.185 request id: app - uvicorn.server:serve - Finished server process [80701]
INFO     2022-03-19 20:55:33.185 request id: app - uvicorn.server:serve - Finished server process [80701]
INFO     2022-03-19 20:55:33.562 request id: app - uvicorn.server:serve - Started server process [80723]
INFO     2022-03-19 20:55:33.562 request id: app - uvicorn.server:serve - Started server process [80723]
INFO     2022-03-19 20:55:33.562 request id: app - uvicorn.server:serve - Started server process [80723]
INFO     2022-03-19 20:55:33.562 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:55:33.562 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:55:33.562 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:55:33.568 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10519bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:55:33.568 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:55:33.569 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:55:33.569 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:55:33.569 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:57:47.253 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:57:47.253 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:57:47.253 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:57:47.354 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:57:47.355 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:57:47.355 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:57:47.356 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:57:47.356 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:57:47.356 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:57:47.356 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:57:47.356 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:57:47.357 request id: app - uvicorn.server:serve - Finished server process [80723]
INFO     2022-03-19 20:57:47.357 request id: app - uvicorn.server:serve - Finished server process [80723]
INFO     2022-03-19 20:57:47.357 request id: app - uvicorn.server:serve - Finished server process [80723]
INFO     2022-03-19 20:57:47.785 request id: app - uvicorn.server:serve - Started server process [80772]
INFO     2022-03-19 20:57:47.786 request id: app - uvicorn.server:serve - Started server process [80772]
INFO     2022-03-19 20:57:47.786 request id: app - uvicorn.server:serve - Started server process [80772]
INFO     2022-03-19 20:57:47.786 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:57:47.786 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:57:47.786 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:57:47.793 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:57:47.794 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:57:47.794 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:57:47.794 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:57:47.795 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:57:51.151 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:57:51.156 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60550 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:57:51.156 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x10637dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x10637db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104a2d900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x10497fd00>
           └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10497f370>
    └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104a234c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
    │    └ <function subprocess_started at 0x1056a2e60>
    └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104a23520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x1056a2200>
           │       │   └ <uvicorn.server.Server object at 0x104a23520>
           │       └ <function run at 0x104d95240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x10564ac00>
           │    └ <function BaseEventLoop.run_until_complete at 0x104d93520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104d93490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104d95000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104d3fd90>
    └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1057615a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105761630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105701a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10575d210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105701a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106ec3a30>
          └ <fastapi.applications.FastAPI object at 0x10575d210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106eec5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106ec3a30>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x106f1d870>
                     │    │             └ <starlette.requests.Request object at 0x106f3c9d0>
                     │    └ <function exception_handling at 0x106eb3be0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x106f3c9d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x106f1d870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ RuntimeError('asyncio.run() cannot be called from a running event loop')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x10637e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x106454ea0>
          │    │   │      └ <starlette.requests.Request object at 0x106f3c9d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x106ec3970>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ec38e0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x106ec3970>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10575d270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ec38e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1064b8670>
          └ <fastapi.routing.APIRoute object at 0x106e8f910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x106e77c70>
          └ <fastapi.routing.APIRoute object at 0x106e8f910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106f6c5b0>
                     └ <function get_request_handler.<locals>.app at 0x106e77e20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1064b92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x106ec33d0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x106e76ef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x106e8fa00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x106778550>
                 └ <repositories.message.MessageRepository object at 0x106ec33d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x105f506c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x106693490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>
          │        └ <function Model.save at 0x106693010>
          └ <Message: 17>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>
          │    └ <function Model._post_save at 0x106692f80>
          └ <Message: 17>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x106eebdf0>]
          │       └ <function gather at 0x104d77880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 28, in signal_post_save
    message_created('message-create', instance.__dict__)
    │                                 │        └ <attribute '__dict__' of 'Model' objects>
    │                                 └ <Message: 17>
    └ <function message_created at 0x106778790>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./tasks/message.py", line 7, in message_created
    asyncio.run(Kafka.produce(topic, Message))
    │       │   │     │       │      └ <class 'schemas.message.Message'>
    │       │   │     │       └ 'message-create'
    │       │   │     └ <staticmethod(<function Kafka.produce at 0x106778940>)>
    │       │   └ <class 'core.kafka.Kafka'>
    │       └ <function run at 0x104d95240>
    └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 33, in run
    raise RuntimeError(

RuntimeError: asyncio.run() cannot be called from a running event loop
ERROR    2022-03-19 20:57:51.168 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x10637dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x10637db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104a2d900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x10497fd00>
           └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10497f370>
    └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104a234c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
    │    └ <function subprocess_started at 0x1056a2e60>
    └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104a23520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x1056a2200>
           │       │   └ <uvicorn.server.Server object at 0x104a23520>
           │       └ <function run at 0x104d95240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x10564ac00>
           │    └ <function BaseEventLoop.run_until_complete at 0x104d93520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104d93490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104d95000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104d3fd90>
    └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1057615a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105761630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105701a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10575d210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105701a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106ec3a30>
          └ <fastapi.applications.FastAPI object at 0x10575d210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106eec5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106ec3a30>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x106f1d870>
                     │    │             └ <starlette.requests.Request object at 0x106f3c9d0>
                     │    └ <function exception_handling at 0x106eb3be0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x106f3c9d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x106f1d870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ RuntimeError('asyncio.run() cannot be called from a running event loop')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x10637e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x106454ea0>
          │    │   │      └ <starlette.requests.Request object at 0x106f3c9d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x106ec3970>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ec38e0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x106ec3970>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10575d270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ec38e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1064b8670>
          └ <fastapi.routing.APIRoute object at 0x106e8f910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x106e77c70>
          └ <fastapi.routing.APIRoute object at 0x106e8f910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106f6c5b0>
                     └ <function get_request_handler.<locals>.app at 0x106e77e20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1064b92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x106ec33d0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x106e76ef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x106e8fa00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x106778550>
                 └ <repositories.message.MessageRepository object at 0x106ec33d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x105f506c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x106693490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>
          │        └ <function Model.save at 0x106693010>
          └ <Message: 17>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>
          │    └ <function Model._post_save at 0x106692f80>
          └ <Message: 17>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x106eebdf0>]
          │       └ <function gather at 0x104d77880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 28, in signal_post_save
    message_created('message-create', instance.__dict__)
    │                                 │        └ <attribute '__dict__' of 'Model' objects>
    │                                 └ <Message: 17>
    └ <function message_created at 0x106778790>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./tasks/message.py", line 7, in message_created
    asyncio.run(Kafka.produce(topic, Message))
    │       │   │     │       │      └ <class 'schemas.message.Message'>
    │       │   │     │       └ 'message-create'
    │       │   │     └ <staticmethod(<function Kafka.produce at 0x106778940>)>
    │       │   └ <class 'core.kafka.Kafka'>
    │       └ <function run at 0x104d95240>
    └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 33, in run
    raise RuntimeError(

RuntimeError: asyncio.run() cannot be called from a running event loop
ERROR    2022-03-19 20:57:51.175 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x10637dab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x10637db40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104a2d900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x10497fd00>
           └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x10497f370>
    └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104a234c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
    │    └ <function subprocess_started at 0x1056a2e60>
    └ <SpawnProcess name='SpawnProcess-24' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104a23520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x1056a2200>
           │       │   └ <uvicorn.server.Server object at 0x104a23520>
           │       └ <function run at 0x104d95240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x10564ac00>
           │    └ <function BaseEventLoop.run_until_complete at 0x104d93520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x104d93490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x104d95000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x104d3fd90>
    └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x106f6ce80>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x1057615a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105761630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105701a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x10575d210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105701a80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106ec3a30>
          └ <fastapi.applications.FastAPI object at 0x10575d210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x106eec5e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x106ec3a30>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x106f1d870>
                     │    │             └ <starlette.requests.Request object at 0x106f3c9d0>
                     │    └ <function exception_handling at 0x106eb3be0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x106f3c9d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x106f1d870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ RuntimeError('asyncio.run() cannot be called from a running event loop')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x10637e290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x106454ea0>
          │    │   │      └ <starlette.requests.Request object at 0x106f3c9d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x106ec3970>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x106ec39a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ec38e0>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x106ec3970>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x10575d270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x106ec38e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1064b8670>
          └ <fastapi.routing.APIRoute object at 0x106e8f910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x106f1e830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x106f3c970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x106e77c70>
          └ <fastapi.routing.APIRoute object at 0x106e8f910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x106f6c5b0>
                     └ <function get_request_handler.<locals>.app at 0x106e77e20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1064b92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x106ec33d0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x106e76ef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x106e8fa00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x106778550>
                 └ <repositories.message.MessageRepository object at 0x106ec33d0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x105f506c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x106693490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>
          │        └ <function Model.save at 0x106693010>
          └ <Message: 17>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x106ec3b20>
          │    └ <function Model._post_save at 0x106692f80>
          └ <Message: 17>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x106eebdf0>]
          │       └ <function gather at 0x104d77880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 28, in signal_post_save
    message_created('message-create', instance.__dict__)
    │                                 │        └ <attribute '__dict__' of 'Model' objects>
    │                                 └ <Message: 17>
    └ <function message_created at 0x106778790>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./tasks/message.py", line 7, in message_created
    asyncio.run(Kafka.produce(topic, Message))
    │       │   │     │       │      └ <class 'schemas.message.Message'>
    │       │   │     │       └ 'message-create'
    │       │   │     └ <staticmethod(<function Kafka.produce at 0x106778940>)>
    │       │   └ <class 'core.kafka.Kafka'>
    │       └ <function run at 0x104d95240>
    └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 33, in run
    raise RuntimeError(

RuntimeError: asyncio.run() cannot be called from a running event loop
INFO     2022-03-19 20:58:34.127 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:58:34.128 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:58:34.128 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:58:34.229 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:58:34.230 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:58:34.230 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:58:34.232 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:58:34.232 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:58:34.232 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:58:34.232 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:58:34.232 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:58:34.233 request id: app - uvicorn.server:serve - Finished server process [80772]
INFO     2022-03-19 20:58:34.233 request id: app - uvicorn.server:serve - Finished server process [80772]
INFO     2022-03-19 20:58:34.233 request id: app - uvicorn.server:serve - Finished server process [80772]
INFO     2022-03-19 20:58:34.617 request id: app - uvicorn.server:serve - Started server process [80799]
INFO     2022-03-19 20:58:34.617 request id: app - uvicorn.server:serve - Started server process [80799]
INFO     2022-03-19 20:58:34.617 request id: app - uvicorn.server:serve - Started server process [80799]
INFO     2022-03-19 20:58:34.617 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:58:34.617 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:58:34.617 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:58:34.623 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x1071dfac0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:58:34.623 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:58:34.624 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:58:34.624 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:58:34.624 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:58:45.132 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:58:45.132 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:58:45.132 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 20:58:45.233 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:58:45.234 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:58:45.234 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 20:58:45.235 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 20:58:45.235 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 20:58:45.235 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:58:45.236 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:58:45.236 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 20:58:45.236 request id: app - uvicorn.server:serve - Finished server process [80799]
INFO     2022-03-19 20:58:45.236 request id: app - uvicorn.server:serve - Finished server process [80799]
INFO     2022-03-19 20:58:45.236 request id: app - uvicorn.server:serve - Finished server process [80799]
INFO     2022-03-19 20:58:45.615 request id: app - uvicorn.server:serve - Started server process [80822]
INFO     2022-03-19 20:58:45.615 request id: app - uvicorn.server:serve - Started server process [80822]
INFO     2022-03-19 20:58:45.615 request id: app - uvicorn.server:serve - Started server process [80822]
INFO     2022-03-19 20:58:45.616 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:58:45.616 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:58:45.616 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 20:58:45.622 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 20:58:45.622 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 20:58:45.623 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:58:45.623 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:58:45.623 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 20:58:50.549 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 20:58:50.570 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60568 - "POST /api/messages/ HTTP/1.1" 500
ERROR    2022-03-19 20:58:50.570 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1072adab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1072adb40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104d55900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104c8bd00>
           └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104c8b370>
    └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104d4b4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
    │    └ <function subprocess_started at 0x105baee60>
    └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104d4b520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105bae200>
           │       │   └ <uvicorn.server.Server object at 0x104d4b520>
           │       └ <function run at 0x105105240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105b56c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x105103520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105103490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105105000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1050afd90>
    └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105c6d5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105c6d630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c0da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c69210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c0da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11069b9a0>
          └ <fastapi.applications.FastAPI object at 0x105c69210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1106c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11069b9a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1106f5870>
                     │    │             └ <starlette.requests.Request object at 0x1110189d0>
                     │    └ <function exception_handling at 0x11068bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1110189d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1106f5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('Object of type ModelMetaclass is not JSON serializable')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1072ae290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x107384d60>
          │    │   │      └ <starlette.requests.Request object at 0x1110189d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x11069b8e0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11069b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x11069b8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c69270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11069b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1073e8670>
          └ <fastapi.routing.APIRoute object at 0x110667910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x11064fc70>
          └ <fastapi.routing.APIRoute object at 0x110667910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1110405e0>
                     └ <function get_request_handler.<locals>.app at 0x11064fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1073e92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1110408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x11064eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x110667a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107698550>
                 └ <repositories.message.MessageRepository object at 0x1110408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x106d306c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x1075c3490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>
          │        └ <function Model.save at 0x1075c3010>
          └ <Message: 18>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>
          │    └ <function Model._post_save at 0x1075c2f80>
          └ <Message: 18>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x1106c3df0>]
          │       └ <function gather at 0x1050e7880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 28, in signal_post_save
    await message_created('message-create', instance.__dict__)
          │                                 │        └ <attribute '__dict__' of 'Model' objects>
          │                                 └ <Message: 18>
          └ <function message_created at 0x107698790>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./tasks/message.py", line 7, in message_created
    await Kafka.produce(topic, Message)
          │     │       │      └ <class 'schemas.message.Message'>
          │     │       └ 'message-create'
          │     └ <staticmethod(<function Kafka.produce at 0x107698940>)>
          └ <class 'core.kafka.Kafka'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/kafka.py", line 16, in produce
    await producer.send_and_wait(topic, json.dumps(data).encode('utf-8'))
          │        │             │      │    │     └ <class 'schemas.message.Message'>
          │        │             │      │    └ <function dumps at 0x10515ec20>
          │        │             │      └ <module 'json' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/__init__.py'>
          │        │             └ 'message-create'
          │        └ <function AIOKafkaProducer.send_and_wait at 0x11064e5f0>
          └ <aiokafka.producer.producer.AIOKafkaProducer object at 0x111040f40>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ <class 'schemas.message.Message'>
           │                └ <function JSONEncoder.encode at 0x10515ef80>
           └ <json.encoder.JSONEncoder object at 0x104d84400>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ <class 'schemas.message.Message'>
             │    └ <function JSONEncoder.iterencode at 0x10515f010>
             └ <json.encoder.JSONEncoder object at 0x104d84400>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ <class 'schemas.message.Message'>
           └ <_json.Encoder object at 0x11107e380>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ModelMetaclass is not JSON serializable
ERROR    2022-03-19 20:58:50.580 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1072adab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1072adb40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104d55900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104c8bd00>
           └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104c8b370>
    └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104d4b4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
    │    └ <function subprocess_started at 0x105baee60>
    └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104d4b520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105bae200>
           │       │   └ <uvicorn.server.Server object at 0x104d4b520>
           │       └ <function run at 0x105105240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105b56c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x105103520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105103490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105105000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1050afd90>
    └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105c6d5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105c6d630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c0da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c69210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c0da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11069b9a0>
          └ <fastapi.applications.FastAPI object at 0x105c69210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1106c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11069b9a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1106f5870>
                     │    │             └ <starlette.requests.Request object at 0x1110189d0>
                     │    └ <function exception_handling at 0x11068bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1110189d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1106f5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('Object of type ModelMetaclass is not JSON serializable')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1072ae290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x107384d60>
          │    │   │      └ <starlette.requests.Request object at 0x1110189d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x11069b8e0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11069b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x11069b8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c69270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11069b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1073e8670>
          └ <fastapi.routing.APIRoute object at 0x110667910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x11064fc70>
          └ <fastapi.routing.APIRoute object at 0x110667910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1110405e0>
                     └ <function get_request_handler.<locals>.app at 0x11064fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1073e92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1110408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x11064eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x110667a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107698550>
                 └ <repositories.message.MessageRepository object at 0x1110408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x106d306c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x1075c3490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>
          │        └ <function Model.save at 0x1075c3010>
          └ <Message: 18>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>
          │    └ <function Model._post_save at 0x1075c2f80>
          └ <Message: 18>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x1106c3df0>]
          │       └ <function gather at 0x1050e7880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 28, in signal_post_save
    await message_created('message-create', instance.__dict__)
          │                                 │        └ <attribute '__dict__' of 'Model' objects>
          │                                 └ <Message: 18>
          └ <function message_created at 0x107698790>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./tasks/message.py", line 7, in message_created
    await Kafka.produce(topic, Message)
          │     │       │      └ <class 'schemas.message.Message'>
          │     │       └ 'message-create'
          │     └ <staticmethod(<function Kafka.produce at 0x107698940>)>
          └ <class 'core.kafka.Kafka'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/kafka.py", line 16, in produce
    await producer.send_and_wait(topic, json.dumps(data).encode('utf-8'))
          │        │             │      │    │     └ <class 'schemas.message.Message'>
          │        │             │      │    └ <function dumps at 0x10515ec20>
          │        │             │      └ <module 'json' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/__init__.py'>
          │        │             └ 'message-create'
          │        └ <function AIOKafkaProducer.send_and_wait at 0x11064e5f0>
          └ <aiokafka.producer.producer.AIOKafkaProducer object at 0x111040f40>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ <class 'schemas.message.Message'>
           │                └ <function JSONEncoder.encode at 0x10515ef80>
           └ <json.encoder.JSONEncoder object at 0x104d84400>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ <class 'schemas.message.Message'>
             │    └ <function JSONEncoder.iterencode at 0x10515f010>
             └ <json.encoder.JSONEncoder object at 0x104d84400>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ <class 'schemas.message.Message'>
           └ <_json.Encoder object at 0x11107e380>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ModelMetaclass is not JSON serializable
ERROR    2022-03-19 20:58:50.587 request id: app - uvicorn.protocols.http.h11_impl:run_asgi - Exception in ASGI application

Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 81, in receive
    return self.receive_nowait()
           │    └ <function MemoryObjectReceiveStream.receive_nowait at 0x1072adab0>
           └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 76, in receive_nowait
    raise WouldBlock
          └ <class 'anyio.WouldBlock'>

anyio.WouldBlock


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 41, in call_next
    message = await recv_stream.receive()
                    │           └ <function MemoryObjectReceiveStream.receive at 0x1072adb40>
                    └ MemoryObjectReceiveStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_rece...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/anyio/streams/memory.py", line 101, in receive
    raise EndOfStream
          └ <class 'anyio.EndOfStream'>

anyio.EndOfStream


During handling of the above exception, another exception occurred:


Traceback (most recent call last):

  File "<string>", line 1, in <module>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 116, in spawn_main
    exitcode = _main(fd, parent_sentinel)
               │     │   └ 4
               │     └ 7
               └ <function _main at 0x104d55900>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/spawn.py", line 129, in _main
    return self._bootstrap(parent_sentinel)
           │    │          └ 4
           │    └ <function BaseProcess._bootstrap at 0x104c8bd00>
           └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 315, in _bootstrap
    self.run()
    │    └ <function BaseProcess.run at 0x104c8b370>
    └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/multiprocessing/process.py", line 108, in run
    self._target(*self._args, **self._kwargs)
    │    │        │    │        │    └ {'config': <uvicorn.config.Config object at 0x104d4b4c0>, 'target': <bound method Server.run of <uvicorn.server.Server object...
    │    │        │    │        └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
    │    │        │    └ ()
    │    │        └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
    │    └ <function subprocess_started at 0x105baee60>
    └ <SpawnProcess name='SpawnProcess-26' parent=79373 started>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/subprocess.py", line 76, in subprocess_started
    target(sockets=sockets)
    │              └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
    └ <bound method Server.run of <uvicorn.server.Server object at 0x104d4b520>>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/server.py", line 60, in run
    return asyncio.run(self.serve(sockets=sockets))
           │       │   │    │             └ [<socket.socket fd=3, family=AddressFamily.AF_INET, type=SocketKind.SOCK_STREAM, proto=0, laddr=('0.0.0.0', 8000)>]
           │       │   │    └ <function Server.serve at 0x105bae200>
           │       │   └ <uvicorn.server.Server object at 0x104d4b520>
           │       └ <function run at 0x105105240>
           └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/runners.py", line 44, in run
    return loop.run_until_complete(main)
           │    │                  └ <coroutine object Server.serve at 0x105b56c00>
           │    └ <function BaseEventLoop.run_until_complete at 0x105103520>
           └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 628, in run_until_complete
    self.run_forever()
    │    └ <function BaseEventLoop.run_forever at 0x105103490>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 595, in run_forever
    self._run_once()
    │    └ <function BaseEventLoop._run_once at 0x105105000>
    └ <_UnixSelectorEventLoop running=True closed=False debug=False>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/base_events.py", line 1881, in _run_once
    handle._run()
    │      └ <function Handle._run at 0x1050afd90>
    └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/events.py", line 80, in _run
    self._context.run(self._callback, *self._args)
    │    │            │    │           │    └ <member '_args' of 'Handle' objects>
    │    │            │    │           └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
    │    │            │    └ <member '_callback' of 'Handle' objects>
    │    │            └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
    │    └ <member '_context' of 'Handle' objects>
    └ <Handle <TaskStepMethWrapper object at 0x111040e80>()>
> File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 366, in run_asgi
    result = await app(self.scope, self.receive, self.send)
                   │   │    │      │    │        │    └ <function RequestResponseCycle.send at 0x105c6d5a0>
                   │   │    │      │    │        └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   │   │    │      │    └ <function RequestResponseCycle.receive at 0x105c6d630>
                   │   │    │      └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   │   │    └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                   │   └ <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>
                   └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c0da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 75, in __call__
    return await self.app(scope, receive, send)
                 │    │   │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                 │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                 │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
                 │    └ <fastapi.applications.FastAPI object at 0x105c69210>
                 └ <uvicorn.middleware.proxy_headers.ProxyHeadersMiddleware object at 0x105c0da80>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/applications.py", line 261, in __call__
    await super().__call__(scope, receive, send)
                           │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                           │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
                           └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
          │    │                │      │        └ <bound method RequestResponseCycle.send of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │                │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │                └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11069b9a0>
          └ <fastapi.applications.FastAPI object at 0x105c69210>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 181, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/errors.py", line 159, in __call__
    await self.app(scope, receive, _send)
          │    │   │      │        └ <function ServerErrorMiddleware.__call__.<locals>._send at 0x1106c45e0>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>
          └ <starlette.middleware.errors.ServerErrorMiddleware object at 0x11069b9a0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 63, in __call__
    response = await self.dispatch_func(request, call_next)
                     │    │             │        └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1106f5870>
                     │    │             └ <starlette.requests.Request object at 0x1110189d0>
                     │    └ <function exception_handling at 0x11068bbe0>
                     └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./main.py", line 21, in exception_handling
    return await call_next(request)
                 │         └ <starlette.requests.Request object at 0x1110189d0>
                 └ <function BaseHTTPMiddleware.__call__.<locals>.call_next at 0x1106f5870>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 44, in call_next
    raise app_exc
          └ TypeError('Object of type ModelMetaclass is not JSON serializable')
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/middleware/base.py", line 34, in coro
    await self.app(scope, request.receive, send_stream.send)
          │    │   │      │       │        │           └ <function MemoryObjectSendStream.send at 0x1072ae290>
          │    │   │      │       │        └ MemoryObjectSendStream(_state=MemoryObjectStreamState(max_buffer_size=0, buffer=deque([]), open_send_channels=0, open_receive...
          │    │   │      │       └ <property object at 0x107384d60>
          │    │   │      └ <starlette.requests.Request object at 0x1110189d0>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <starlette.exceptions.ExceptionMiddleware object at 0x11069b8e0>
          └ <starlette.middleware.base.BaseHTTPMiddleware object at 0x11069b910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 82, in __call__
    raise exc
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/exceptions.py", line 71, in __call__
    await self.app(scope, receive, sender)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11069b850>
          └ <starlette.exceptions.ExceptionMiddleware object at 0x11069b8e0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 21, in __call__
    raise e
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <fastapi.routing.APIRouter object at 0x105c69270>
          └ <fastapi.middleware.asyncexitstack.AsyncExitStackMiddleware object at 0x11069b850>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 656, in __call__
    await route.handle(scope, receive, send)
          │     │      │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │     │      │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │     │      └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │     └ <function Route.handle at 0x1073e8670>
          └ <fastapi.routing.APIRoute object at 0x110667910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 259, in handle
    await self.app(scope, receive, send)
          │    │   │      │        └ <function ExceptionMiddleware.__call__.<locals>.sender at 0x1106f6830>
          │    │   │      └ <bound method RequestResponseCycle.receive of <uvicorn.protocols.http.h11_impl.RequestResponseCycle object at 0x111018970>>
          │    │   └ {'type': 'http', 'asgi': {'version': '3.0', 'spec_version': '2.3'}, 'http_version': '1.1', 'server': ('127.0.0.1', 8000), 'cl...
          │    └ <function request_response.<locals>.app at 0x11064fc70>
          └ <fastapi.routing.APIRoute object at 0x110667910>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/starlette/routing.py", line 61, in app
    response = await func(request)
                     │    └ <starlette.requests.Request object at 0x1110405e0>
                     └ <function get_request_handler.<locals>.app at 0x11064fe20>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 227, in app
    raw_response = await run_endpoint_function(
                         └ <function run_endpoint_function at 0x1073e92d0>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/fastapi/routing.py", line 160, in run_endpoint_function
    return await dependant.call(**values)
                 │         │      └ {'repository': <repositories.message.MessageRepository object at 0x1110408e0>, 'data': MessageIn(message='string'), 'backgrou...
                 │         └ <function create_message at 0x11064eef0>
                 └ <fastapi.dependencies.models.Dependant object at 0x110667a00>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./routes/message.py", line 19, in create_message
    post = await repository.create(data)
                 │          │      └ MessageIn(message='string')
                 │          └ <function MessageRepository.create at 0x107698550>
                 └ <repositories.message.MessageRepository object at 0x1110408e0>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./repositories/message.py", line 15, in create
    message = await Message.create(**credential.dict(exclude_unset=True))
                    │       │        │          └ <cyfunction BaseModel.dict at 0x106d306c0>
                    │       │        └ MessageIn(message='string')
                    │       └ <classmethod(<function Model.create at 0x1075c3490>)>
                    └ <class 'models.message.Message'>

  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 1117, in create
    await instance.save(using_db=db, force_create=True)
          │        │             └ <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>
          │        └ <function Model.save at 0x1075c3010>
          └ <Message: 18>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 959, in save
    await self._post_save(db, created, update_fields)
          │    │          │   │        └ None
          │    │          │   └ True
          │    │          └ <tortoise.backends.sqlite.client.SqliteClient object at 0x11069bb20>
          │    └ <function Model._post_save at 0x1075c2f80>
          └ <Message: 18>
  File "/Users/ckam/Library/Caches/pypoetry/virtualenvs/fastapi-apache-kafka-mluS8fn_-py3.10/lib/python3.10/site-packages/tortoise/models.py", line 895, in _post_save
    await asyncio.gather(*listeners)
          │       │       └ [<coroutine object signal_post_save at 0x1106c3df0>]
          │       └ <function gather at 0x1050e7880>
          └ <module 'asyncio' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/asyncio/__init__.py'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./signals/message.py", line 28, in signal_post_save
    await message_created('message-create', instance.__dict__)
          │                                 │        └ <attribute '__dict__' of 'Model' objects>
          │                                 └ <Message: 18>
          └ <function message_created at 0x107698790>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./tasks/message.py", line 7, in message_created
    await Kafka.produce(topic, Message)
          │     │       │      └ <class 'schemas.message.Message'>
          │     │       └ 'message-create'
          │     └ <staticmethod(<function Kafka.produce at 0x107698940>)>
          └ <class 'core.kafka.Kafka'>

  File "/Users/ckam/Workspace/lab/fastapi-apache-kafka/./core/kafka.py", line 16, in produce
    await producer.send_and_wait(topic, json.dumps(data).encode('utf-8'))
          │        │             │      │    │     └ <class 'schemas.message.Message'>
          │        │             │      │    └ <function dumps at 0x10515ec20>
          │        │             │      └ <module 'json' from '/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/__init__.py'>
          │        │             └ 'message-create'
          │        └ <function AIOKafkaProducer.send_and_wait at 0x11064e5f0>
          └ <aiokafka.producer.producer.AIOKafkaProducer object at 0x111040f40>

  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/__init__.py", line 231, in dumps
    return _default_encoder.encode(obj)
           │                │      └ <class 'schemas.message.Message'>
           │                └ <function JSONEncoder.encode at 0x10515ef80>
           └ <json.encoder.JSONEncoder object at 0x104d84400>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 199, in encode
    chunks = self.iterencode(o, _one_shot=True)
             │    │          └ <class 'schemas.message.Message'>
             │    └ <function JSONEncoder.iterencode at 0x10515f010>
             └ <json.encoder.JSONEncoder object at 0x104d84400>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 257, in iterencode
    return _iterencode(o, 0)
           │           └ <class 'schemas.message.Message'>
           └ <_json.Encoder object at 0x11107e380>
  File "/Library/Frameworks/Python.framework/Versions/3.10/lib/python3.10/json/encoder.py", line 179, in default
    raise TypeError(f'Object of type {o.__class__.__name__} '

TypeError: Object of type ModelMetaclass is not JSON serializable
INFO     2022-03-19 21:01:55.323 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:01:55.323 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:01:55.323 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:01:55.424 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:01:55.424 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:01:55.425 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:01:55.427 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 21:01:55.427 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 21:01:55.428 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:01:55.428 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:01:55.428 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:01:55.428 request id: app - uvicorn.server:serve - Finished server process [80822]
INFO     2022-03-19 21:01:55.428 request id: app - uvicorn.server:serve - Finished server process [80822]
INFO     2022-03-19 21:01:55.428 request id: app - uvicorn.server:serve - Finished server process [80822]
INFO     2022-03-19 21:01:55.804 request id: app - uvicorn.server:serve - Started server process [80867]
INFO     2022-03-19 21:01:55.804 request id: app - uvicorn.server:serve - Started server process [80867]
INFO     2022-03-19 21:01:55.804 request id: app - uvicorn.server:serve - Started server process [80867]
INFO     2022-03-19 21:01:55.804 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:01:55.804 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:01:55.804 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:01:55.810 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x102d4faf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 21:01:55.810 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 21:01:55.811 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:01:55.811 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:01:55.811 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:24.899 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:24.900 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:24.900 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:25.001 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:25.001 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:25.002 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:25.004 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 21:03:25.004 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 21:03:25.004 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:25.005 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:25.005 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:25.005 request id: app - uvicorn.server:serve - Finished server process [80867]
INFO     2022-03-19 21:03:25.005 request id: app - uvicorn.server:serve - Finished server process [80867]
INFO     2022-03-19 21:03:25.005 request id: app - uvicorn.server:serve - Finished server process [80867]
INFO     2022-03-19 21:03:25.390 request id: app - uvicorn.server:serve - Started server process [80903]
INFO     2022-03-19 21:03:25.390 request id: app - uvicorn.server:serve - Started server process [80903]
INFO     2022-03-19 21:03:25.390 request id: app - uvicorn.server:serve - Started server process [80903]
INFO     2022-03-19 21:03:25.390 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:25.390 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:25.390 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:25.396 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10499faf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 21:03:25.396 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 21:03:25.397 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:25.397 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:25.397 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:41.170 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:41.170 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:41.171 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:41.271 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:41.272 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:41.272 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:41.273 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 21:03:41.273 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 21:03:41.274 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:41.274 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:41.274 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:41.274 request id: app - uvicorn.server:serve - Finished server process [80903]
INFO     2022-03-19 21:03:41.274 request id: app - uvicorn.server:serve - Finished server process [80903]
INFO     2022-03-19 21:03:41.274 request id: app - uvicorn.server:serve - Finished server process [80903]
INFO     2022-03-19 21:03:41.668 request id: app - uvicorn.server:serve - Started server process [80927]
INFO     2022-03-19 21:03:41.668 request id: app - uvicorn.server:serve - Started server process [80927]
INFO     2022-03-19 21:03:41.668 request id: app - uvicorn.server:serve - Started server process [80927]
INFO     2022-03-19 21:03:41.669 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:41.669 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:41.669 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:41.674 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10619baf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 21:03:41.674 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 21:03:41.675 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:41.675 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:41.675 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:50.777 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:50.777 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:50.777 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:03:50.879 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:50.879 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:50.879 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:03:50.880 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 21:03:50.880 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 21:03:50.881 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:50.881 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:50.881 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:03:50.881 request id: app - uvicorn.server:serve - Finished server process [80927]
INFO     2022-03-19 21:03:50.881 request id: app - uvicorn.server:serve - Finished server process [80927]
INFO     2022-03-19 21:03:50.881 request id: app - uvicorn.server:serve - Finished server process [80927]
INFO     2022-03-19 21:03:51.261 request id: app - uvicorn.server:serve - Started server process [80958]
INFO     2022-03-19 21:03:51.261 request id: app - uvicorn.server:serve - Started server process [80958]
INFO     2022-03-19 21:03:51.261 request id: app - uvicorn.server:serve - Started server process [80958]
INFO     2022-03-19 21:03:51.261 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:51.261 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:51.261 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:03:51.267 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10579baf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 21:03:51.267 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 21:03:51.267 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:51.267 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:03:51.268 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:04:05.735 request id: None - main:exception_handling - new POST request
INFO     2022-03-19 21:04:05.763 request id: app - uvicorn.protocols.http.h11_impl:send - 127.0.0.1:60614 - "POST /api/messages/ HTTP/1.1" 200
INFO     2022-03-19 21:04:54.701 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:04:54.701 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:04:54.701 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:04:54.802 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:04:54.803 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:04:54.803 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:04:54.805 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 21:04:54.805 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 21:04:54.805 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:04:54.805 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:04:54.805 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:04:54.805 request id: app - uvicorn.server:serve - Finished server process [80958]
INFO     2022-03-19 21:04:54.805 request id: app - uvicorn.server:serve - Finished server process [80958]
INFO     2022-03-19 21:04:54.805 request id: app - uvicorn.server:serve - Finished server process [80958]
INFO     2022-03-19 21:04:55.218 request id: app - uvicorn.server:serve - Started server process [80992]
INFO     2022-03-19 21:04:55.218 request id: app - uvicorn.server:serve - Started server process [80992]
INFO     2022-03-19 21:04:55.219 request id: app - uvicorn.server:serve - Started server process [80992]
INFO     2022-03-19 21:04:55.219 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:04:55.219 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:04:55.219 request id: app - uvicorn.lifespan.on:startup - Waiting for application startup.
INFO     2022-03-19 21:04:55.226 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM started, {'default': <tortoise.backends.sqlite.client.SqliteClient object at 0x10361faf0>}, {'models': {'Message': <class 'models.message.Message'>}}
INFO     2022-03-19 21:04:55.227 request id: app - tortoise.contrib.fastapi:init_orm - Tortoise-ORM generating schema
INFO     2022-03-19 21:04:55.227 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:04:55.227 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:04:55.228 request id: app - uvicorn.lifespan.on:startup - Application startup complete.
INFO     2022-03-19 21:08:54.919 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:08:54.920 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:08:54.921 request id: app - uvicorn.server:shutdown - Shutting down
INFO     2022-03-19 21:08:55.023 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:08:55.023 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:08:55.023 request id: app - uvicorn.lifespan.on:shutdown - Waiting for application shutdown.
INFO     2022-03-19 21:08:55.026 request id: app - tortoise:close_connections - Tortoise-ORM shutdown
INFO     2022-03-19 21:08:55.026 request id: app - tortoise.contrib.fastapi:close_orm - Tortoise-ORM shutdown
INFO     2022-03-19 21:08:55.027 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:08:55.027 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:08:55.027 request id: app - uvicorn.lifespan.on:shutdown - Application shutdown complete.
INFO     2022-03-19 21:08:55.028 request id: app - uvicorn.server:serve - Finished server process [80992]
INFO     2022-03-19 21:08:55.028 request id: app - uvicorn.server:serve - Finished server process [80992]
INFO     2022-03-19 21:08:55.029 request id: app - uvicorn.server:serve - Finished server process [80992]
